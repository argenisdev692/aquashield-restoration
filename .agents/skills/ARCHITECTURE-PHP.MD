# PHP 8.5 Â· Laravel 12 Â· Enterprise Architecture 2026

src/
â”‚
â”œâ”€â”€ Core/ # ğŸ”§ Cross-cutting concerns
â”‚ â”‚
â”‚ â”œâ”€â”€ Shared/ # Shared code across contexts
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Domain/ # Shared domain
â”‚ â”‚ â”‚ â”œâ”€â”€ Exceptions/ # Base domain exceptions
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ DomainException.php
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ ValidationException.php
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ EntityNotFoundException.php
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ UnauthorizedException.php
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ BusinessRuleViolationException.php
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ ConcurrencyException.php # ğŸ”¥ Optimistic locking / race conditions
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ InvariantViolationException.php # ğŸ”¥ Aggregate invariant broken
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ IntegrationException.php # ğŸ”¥ Failure in external services
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ ValueObjects/ # Value Objects (readonly + clone with PHP 8.5)
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ Uuid.php # ğŸ”¥ readonly + ramsey/uuid + clone with
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ Email.php # ğŸ§¬ readonly + clone with
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ PhoneNumber.php # ğŸ§¬ readonly + clone with
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ Timestamp.php # ğŸ§¬ readonly + clone with
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ Money.php # ğŸ§¬ readonly + clone with
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ Url.php # ğŸ§¬ readonly + PHP 8.5 Uri extension
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ DateRange.php # ğŸ§¬ readonly + clone with
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ Entities/ # Base entities
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ AggregateRoot.php # ğŸ§¬ #[Override] support for child properties
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ Ports/ # ğŸ”¥ Shared interfaces (ports)
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ CachePort.php
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ QueuePort.php
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ LoggerPort.php
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ EventPublisherPort.php
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ NotificationPort.php
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ AuditPort.php # ğŸ”¥ Audit (spatie/activitylog)
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ ExportPort.php # ğŸ”¥ Export/Import (maatwebsite/excel + barryvdh/laravel-dompdf)
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â””â”€â”€ Events/ # Event system
â”‚ â”‚ â”‚ â”œâ”€â”€ DomainEvent.php
â”‚ â”‚ â”‚ â”œâ”€â”€ DomainEventPublisher.php
â”‚ â”‚ â”‚ â””â”€â”€ DomainEventSubscriber.php
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Application/ # Shared application
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ Bus/ # CQRS Bus
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ Command/
â”‚ â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ CommandBus.php
â”‚ â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ CommandBusInterface.php
â”‚ â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ CommandHandler.php
â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€ SyncCommandBus.php
â”‚ â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ Query/
â”‚ â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ QueryBus.php
â”‚ â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ QueryBusInterface.php
â”‚ â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ QueryHandler.php
â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€ SyncQueryBus.php
â”‚ â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ Event/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ EventBus.php
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ EventBusInterface.php
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ DTOs/ # Base DTOs (spatie/laravel-data + PHP 8.5)
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ BaseDTO.php # ğŸ§¬ extends Data + closures in constant expressions
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ PaginationDTO.php # ğŸ§¬ readonly + clone with
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ FilterDTO.php # ğŸ§¬ readonly + clone with
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ IntegrationEvents/ # ğŸ”¥ Events BETWEEN contexts (ACL)
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ IntegrationEvent.php # Base class for integration events
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ IntegrationEventBus.php # Bus that communicates between bounded contexts
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ ACL/ # ğŸ”¥ Anti-Corruption Layer
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ AntiCorruptionLayerInterface.php # Translates models between contexts
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â””â”€â”€ Services/ # Shared application services
â”‚ â”‚ â”‚ â”œâ”€â”€ Pagination/
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ PaginationService.php
â”‚ â”‚ â”‚ â””â”€â”€ Validation/
â”‚ â”‚ â”‚ â””â”€â”€ ValidationService.php
â”‚ â”‚ â”‚
â”‚ â”‚ â””â”€â”€ Infrastructure/ # Shared infrastructure
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Cache/ # Cache system
â”‚ â”‚ â”‚ â”œâ”€â”€ CacheInterface.php
â”‚ â”‚ â”‚ â”œâ”€â”€ RedisAdapter.php
â”‚ â”‚ â”‚ â”œâ”€â”€ MemcachedAdapter.php
â”‚ â”‚ â”‚ â””â”€â”€ InMemoryCacheAdapter.php
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Queue/ # Queue system (uses laravel/horizon)
â”‚ â”‚ â”‚ â”œâ”€â”€ QueueInterface.php
â”‚ â”‚ â”‚ â”œâ”€â”€ LaravelQueueAdapter.php
â”‚ â”‚ â”‚ â”œâ”€â”€ RabbitMQAdapter.php
â”‚ â”‚ â”‚ â””â”€â”€ SqsAdapter.php
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Broadcasting/ # ğŸ”¥ Laravel Reverb / WebSockets
â”‚ â”‚ â”‚ â”œâ”€â”€ BroadcastingInterface.php
â”‚ â”‚ â”‚ â”œâ”€â”€ ReverbAdapter.php # ğŸ”¥ laravel/reverb
â”‚ â”‚ â”‚ â”œâ”€â”€ PusherAdapter.php
â”‚ â”‚ â”‚ â”œâ”€â”€ AblyAdapter.php
â”‚ â”‚ â”‚ â””â”€â”€ Config/
â”‚ â”‚ â”‚ â””â”€â”€ broadcasting.php
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Logging/ # Logging system â€” Monolog as central bus
â”‚ â”‚ â”‚ â”œâ”€â”€ LoggerInterface.php
â”‚ â”‚ â”‚ â”œâ”€â”€ ApplicationLogger.php
â”‚ â”‚ â”‚ â”œâ”€â”€ MonologAdapter.php
â”‚ â”‚ â”‚ â”œâ”€â”€ Handlers/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ OpenTelemetryMonologHandler.php # ğŸ”¥ Monolog â†’ OTEL Collector (OTLP/gRPC)
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ StructuredJsonHandler.php # ğŸ”¥ Structured stdout for k8s/cloud
â”‚ â”‚ â”‚ â”œâ”€â”€ Processors/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ TraceContextProcessor.php # ğŸ”¥ Injects trace_id + span_id into every log
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ CorrelationIdProcessor.php # ğŸ”¥ Injects correlation_id from the request
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ RequestContextProcessor.php # ğŸ”¥ Injects user_id, tenant, route
â”‚ â”‚ â”‚ â””â”€â”€ Formatters/
â”‚ â”‚ â”‚ â”œâ”€â”€ JsonFormatter.php
â”‚ â”‚ â”‚ â””â”€â”€ ContextualFormatter.php
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Observability/ # Metrics & Health & Tracing
â”‚ â”‚ â”‚ â”œâ”€â”€ HealthCheck/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ HealthCheckInterface.php
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ HealthCheckController.php # ğŸ”¥ GET /health â†’ aggregated status
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ HealthCheckAggregator.php # ğŸ”¥ Runs all health checks
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ DatabaseHealthCheck.php
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ RedisHealthCheck.php
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ QueueHealthCheck.php
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ ReverbHealthCheck.php # ğŸ”¥ Health check for Reverb
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ ExternalServiceHealthCheck.php # ğŸ”¥ Resend, S3, Stripe, etc.
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ StorageHealthCheck.php # ğŸ”¥ S3 / local disk
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ Metrics/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ MetricsInterface.php
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ PrometheusAdapter.php # ğŸ”¥ Prometheus pull model
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ PrometheusController.php # ğŸ”¥ GET /metrics â†’ Prometheus format
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ StatsDAdapter.php
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ Tracing/ # ğŸ”¥ Distributed Tracing â€” OTEL SDK 1.x
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ TracingInterface.php
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ OpenTelemetryAdapter.php # ğŸ”¥ OTEL 2026 standard (CNCF Graduated)
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ OpenTelemetryConfig.php # ğŸ”¥ Config: OTLP exporter, sampler, resource
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ OtlpGrpcExporter.php # ğŸ”¥ OTLP/gRPC â†’ Collector (Jaeger/Zipkin receive via OTLP)
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ InstrumentationProvider.php # ğŸ”¥ Registers auto-instrumentation: SQL, HTTP, Redis
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ SpanEnricher.php # ğŸ”¥ Adds context to spans
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â””â”€â”€ Logging/ # ğŸ”¥ Structured Logging â€” bridge OTEL â†” Monolog
â”‚ â”‚ â”‚ â””â”€â”€ OtelMonologBridge.php # ğŸ”¥ Forwards Monolog logs to OTEL Collector via OTLP
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Resilience/ # Resilience
â”‚ â”‚ â”‚ â”œâ”€â”€ CircuitBreaker/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ CircuitBreaker.php
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ CircuitBreakerInterface.php
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ CircuitBreakerState.php
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ CircuitBreakerMetricsExporter.php # ğŸ”¥ Exports state â†’ Prometheus (open/closed/half-open)
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ RateLimiter/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ RateLimiter.php
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ RateLimiterInterface.php
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â””â”€â”€ Retry/
â”‚ â”‚ â”‚ â”œâ”€â”€ RetryPolicy.php
â”‚ â”‚ â”‚ â””â”€â”€ ExponentialBackoff.php
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Persistence/ # Shared persistence
â”‚ â”‚ â”‚ â”œâ”€â”€ Database/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ Connection.php
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ QueryBuilder.php
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â””â”€â”€ Transactions/ # ğŸ”¥ DB Transactions & Rollback
â”‚ â”‚ â”‚ â”œâ”€â”€ TransactionInterface.php
â”‚ â”‚ â”‚ â”œâ”€â”€ DatabaseTransaction.php
â”‚ â”‚ â”‚ â”œâ”€â”€ UnitOfWork.php # ğŸ”¥ Coordinates persist + flush + rollback
â”‚ â”‚ â”‚ â”œâ”€â”€ TransactionalCommandBus.php # ğŸ”¥ Wraps CommandBus in DB::transaction
â”‚ â”‚ â”‚ â””â”€â”€ RollbackStrategy.php # ğŸ”¥ Rollback strategy (auto/manual/saga)
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ EventStore/ # Event Sourcing (optional)
â”‚ â”‚ â”‚ â”œâ”€â”€ EventStore.php
â”‚ â”‚ â”‚ â””â”€â”€ EventStoreInterface.php
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Audit/ # ğŸ”¥ Cross-cutting audit (spatie/activitylog)
â”‚ â”‚ â”‚ â”œâ”€â”€ AuditInterface.php
â”‚ â”‚ â”‚ â”œâ”€â”€ SpatieActivityLogAdapter.php # Wraps spatie/laravel-activitylog
â”‚ â”‚ â”‚ â””â”€â”€ AuditableInterface.php # Contract for auditable models
â”‚ â”‚ â”‚
â”‚ â”‚ â””â”€â”€ Export/ # ğŸ”¥ Cross-cutting Export/Import (maatwebsite/excel + barryvdh/laravel-dompdf)
â”‚ â”‚ â”œâ”€â”€ ExportInterface.php
â”‚ â”‚ â”œâ”€â”€ ExcelAdapter.php # ğŸ”¥ Wraps maatwebsite/excel (FromQuery, WithHeadings, WithMapping, ShouldAutoSize)
â”‚ â”‚ â”œâ”€â”€ PdfAdapter.php # ğŸ”¥ Wraps barryvdh/laravel-dompdf v3 â€” Pdf::loadView() + setPaper() + stream()
â”‚ â”‚ â”œâ”€â”€ PdfTemplateRenderer.php # ğŸ”¥ Resolves Blade view path, injects $filters $generatedAt $rows
â”‚ â”‚ â””â”€â”€ CsvAdapter.php
â”‚ â”‚
â”‚ â”œâ”€â”€ Middleware/ # Global middleware
â”‚ â”‚ â”œâ”€â”€ AuthenticationMiddleware.php
â”‚ â”‚ â”œâ”€â”€ AuthorizationMiddleware.php # ğŸ”¥ Authorize via Gates/Policies
â”‚ â”‚ â”œâ”€â”€ LoggingMiddleware.php
â”‚ â”‚ â”œâ”€â”€ CorrelationIdMiddleware.php
â”‚ â”‚ â”œâ”€â”€ TraceContextMiddleware.php # ğŸ”¥ Propagates OpenTelemetry trace_id
â”‚ â”‚ â”œâ”€â”€ RateLimitMiddleware.php
â”‚ â”‚ â”œâ”€â”€ CookieConsentMiddleware.php # ğŸ”¥ spatie/laravel-cookie-consent
â”‚ â”‚ â””â”€â”€ SecurityHeadersMiddleware.php
â”‚ â”‚
â”‚ â”œâ”€â”€ Pipes/ # Validation Pipes (ğŸ§¬ PHP 8.5 pipe operator |>)
â”‚ â”‚ â”œâ”€â”€ ValidationPipe.php # ğŸ§¬ Uses pipe operator |> internally
â”‚ â”‚ â”œâ”€â”€ TransformationPipe.php # ğŸ§¬ Uses pipe operator |> internally
â”‚ â”‚ â””â”€â”€ SanitizationPipe.php # ğŸ§¬ Uses pipe operator |> internally
â”‚ â”‚
â”‚ â”œâ”€â”€ Filters/ # Exception Filters
â”‚ â”‚ â”œâ”€â”€ GlobalExceptionFilter.php
â”‚ â”‚ â”œâ”€â”€ ValidationExceptionFilter.php
â”‚ â”‚ â”œâ”€â”€ DomainExceptionFilter.php
â”‚ â”‚ â””â”€â”€ HttpExceptionFilter.php
â”‚ â”‚
â”‚ â””â”€â”€ Providers/ # Core Service Providers
â”‚ â”œâ”€â”€ CoreServiceProvider.php
â”‚ â”œâ”€â”€ EventServiceProvider.php
â”‚ â”œâ”€â”€ BusServiceProvider.php
â”‚ â”œâ”€â”€ BroadcastingServiceProvider.php # ğŸ”¥ Reverb Provider
â”‚ â”œâ”€â”€ AuditServiceProvider.php # ğŸ”¥ spatie/activitylog config
â”‚ â””â”€â”€ ExportServiceProvider.php # ğŸ”¥ maatwebsite/excel + barryvdh/laravel-dompdf config

â””â”€â”€ Contexts/ # ğŸ“¦ Bounded Contexts (Modules)
â”‚
â”œâ”€â”€ Auth/ # ğŸ” CONTEXT: Authentication
â”‚ â”‚
â”‚ â”œâ”€â”€ Providers/ # Context Service Providers
â”‚ â”‚ â””â”€â”€ AuthServiceProvider.php
â”‚ â”‚
â”‚ â”œâ”€â”€ Config/ # Context configuration
â”‚ â”‚ â””â”€â”€ auth.php
â”‚ â”‚
â”‚ â”œâ”€â”€ Contracts/ # ğŸ”¥ Published Language (context public API)
â”‚ â”‚ â”œâ”€â”€ AuthServiceContract.php # What other contexts can consume
â”‚ â”‚ â””â”€â”€ DTOs/
â”‚ â”‚ â”œâ”€â”€ AuthenticatedUserDTO.php # Output DTO for other contexts
â”‚ â”‚ â””â”€â”€ TokenValidationResultDTO.php
â”‚ â”‚
â”‚ â”œâ”€â”€ Tests/ # Full context tests
â”‚ â”‚ â”œâ”€â”€ Unit/
â”‚ â”‚ â”‚ â”œâ”€â”€ Domain/
â”‚ â”‚ â”‚ â””â”€â”€ Application/
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Integration/
â”‚ â”‚ â”‚ â””â”€â”€ Infrastructure/
â”‚ â”‚ â”‚
â”‚ â”‚ â””â”€â”€ Feature/
â”‚ â”‚ â”œâ”€â”€ OtpFlowTest.php
â”‚ â”‚ â””â”€â”€ RealtimeAuthTest.php # ğŸ”¥ WebSocket tests
â”‚ â”‚
â”‚ â”œâ”€â”€ Domain/ # â­ LAYER 1: Pure Domain
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Entities/ # Domain entities (ğŸ§¬ #[Override] PHP 8.5)
â”‚ â”‚ â”‚ â”œâ”€â”€ User.php # ğŸ§¬ #[Override] $id: UserId
â”‚ â”‚ â”‚ â”œâ”€â”€ Session.php # ğŸ§¬ #[Override] $id: SessionId
â”‚ â”‚ â”‚ â”œâ”€â”€ RefreshToken.php # ğŸ§¬ #[Override] $id
â”‚ â”‚ â”‚ â””â”€â”€ ApiToken.php # ğŸ§¬ #[Override] $id
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ ValueObjects/ # Value Objects (ğŸ§¬ readonly + clone with PHP 8.5)
â”‚ â”‚ â”‚ â”œâ”€â”€ OtpCode.php # ğŸ§¬ readonly + clone with
â”‚ â”‚ â”‚ â”œâ”€â”€ PhoneNumber.php # ğŸ§¬ readonly + clone with
â”‚ â”‚ â”‚ â”œâ”€â”€ UserEmail.php # ğŸ§¬ readonly + clone with
â”‚ â”‚ â”‚ â”œâ”€â”€ UserId.php # ğŸ§¬ readonly + clone with
â”‚ â”‚ â”‚ â”œâ”€â”€ SessionId.php # ğŸ§¬ readonly + clone with
â”‚ â”‚ â”‚ â”œâ”€â”€ Password.php # ğŸ§¬ readonly + clone with
â”‚ â”‚ â”‚ â”œâ”€â”€ HashedPassword.php # ğŸ§¬ readonly + clone with
â”‚ â”‚ â”‚ â”œâ”€â”€ SetupToken.php # ğŸ”¥ First-access / admin reset token (signed URL token)
â”‚ â”‚ â”‚ â””â”€â”€ IpAddress.php # ğŸ§¬ readonly + clone with
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Enums/ # ğŸ§¬ PHP 8.5 Backed Enums (domain state)
â”‚ â”‚ â”‚ â”œâ”€â”€ OtpStatus.php # pending, verified, expired, revoked
â”‚ â”‚ â”‚ â”œâ”€â”€ SessionStatus.php # active, expired, revoked
â”‚ â”‚ â”‚ â”œâ”€â”€ UserSetupStatus.php # ğŸ”¥ pending_setup, active â€” tracks whether user has set their password
â”‚ â”‚ â”‚ â”œâ”€â”€ AuthProvider.php # email, google, github, microsoft
â”‚ â”‚ â”‚ â””â”€â”€ TokenType.php # access, refresh, api, setup ğŸ”¥ (+setup for first-time access)
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Ports/ # ğŸ”¥ Interfaces (Ports)
â”‚ â”‚ â”‚ â”œâ”€â”€ OtpRepositoryPort.php
â”‚ â”‚ â”‚ â”œâ”€â”€ UserRepositoryPort.php
â”‚ â”‚ â”‚ â”œâ”€â”€ SessionRepositoryPort.php
â”‚ â”‚ â”‚ â””â”€â”€ RefreshTokenRepositoryPort.php
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Services/ # Domain Services (ğŸ§¬ #[NoDiscard] PHP 8.5)
â”‚ â”‚ â”‚ â”œâ”€â”€ OtpGenerator.php # ğŸ”¥ spatie OTP + ğŸ§¬ #[NoDiscard]
â”‚ â”‚ â”‚ â”œâ”€â”€ OtpValidator.php # ğŸ§¬ #[NoDiscard] â€” result must never be ignored
â”‚ â”‚ â”‚ â”œâ”€â”€ PasswordHasher.php # ğŸ§¬ #[NoDiscard]
â”‚ â”‚ â”‚ â”œâ”€â”€ TokenGenerator.php # ğŸ§¬ #[NoDiscard]
â”‚ â”‚ â”‚ â””â”€â”€ SessionManager.php # ğŸ§¬ #[NoDiscard]
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Policies/ # ğŸ”¥ Domain Policies (domain authorization)
â”‚ â”‚ â”‚ â”œâ”€â”€ CanLoginPolicy.php
â”‚ â”‚ â”‚ â”œâ”€â”€ CanResetPasswordPolicy.php
â”‚ â”‚ â”‚ â””â”€â”€ MaxOtpAttemptsPolicy.php
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Authorization/ # ğŸ”¥ Authorization Layer (Gates + Guards)
â”‚ â”‚ â”‚ â”œâ”€â”€ Gates/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ ManageUsersGate.php # ğŸ”¥ Gate::define('manage-users')
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ ManageRolesGate.php
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ ViewAuditLogGate.php
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ Guards/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ SanctumGuard.php # ğŸ”¥ API token guard (laravel/sanctum)
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ SessionGuard.php # ğŸ”¥ Web session guard (fortify)
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ OtpGuard.php # ğŸ”¥ OTP-based auth guard
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â””â”€â”€ LaravelPolicies/ # ğŸ”¥ Laravel Policy classes
â”‚ â”‚ â”‚ â”œâ”€â”€ UserPolicy.php # ğŸ”¥ $this->authorize('update', $user)
â”‚ â”‚ â”‚ â”œâ”€â”€ SessionPolicy.php
â”‚ â”‚ â”‚ â””â”€â”€ TokenPolicy.php
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Events/ # Domain Events
â”‚ â”‚ â”‚ â”œâ”€â”€ OtpGenerated.php
â”‚ â”‚ â”‚ â”œâ”€â”€ OtpVerified.php
â”‚ â”‚ â”‚ â”œâ”€â”€ OtpExpired.php
â”‚ â”‚ â”‚ â”œâ”€â”€ UserRegistered.php
â”‚ â”‚ â”‚ â”œâ”€â”€ UserLoggedIn.php
â”‚ â”‚ â”‚ â”œâ”€â”€ UserLoggedOut.php
â”‚ â”‚ â”‚ â”œâ”€â”€ PasswordChanged.php
â”‚ â”‚ â”‚ â”œâ”€â”€ FirstTimePasswordSet.php # ğŸ”¥ User completed initial password setup
â”‚ â”‚ â”‚ â”œâ”€â”€ PasswordResetByAdmin.php # ğŸ”¥ Super Admin forced a password reset
â”‚ â”‚ â”‚ â””â”€â”€ SessionExpired.php
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Subscribers/ # ğŸ”¥ Domain Event Subscribers (synchronous, same transaction, MUST perform Cache::forget)
â”‚ â”‚ â”‚ â”œâ”€â”€ InvalidateSessionOnPasswordChange.php
â”‚ â”‚ â”‚ â””â”€â”€ RevokeTokensOnLogout.php
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Exceptions/ # Domain Exceptions
â”‚ â”‚ â”‚ â”œâ”€â”€ InvalidOtpException.php
â”‚ â”‚ â”‚ â”œâ”€â”€ ExpiredOtpException.php
â”‚ â”‚ â”‚ â”œâ”€â”€ OtpAlreadyUsedException.php
â”‚ â”‚ â”‚ â”œâ”€â”€ InvalidCredentialsException.php
â”‚ â”‚ â”‚ â”œâ”€â”€ UserAlreadyExistsException.php
â”‚ â”‚ â”‚ â”œâ”€â”€ UserNotFoundException.php
â”‚ â”‚ â”‚ â”œâ”€â”€ SessionExpiredException.php
â”‚ â”‚ â”‚ â”œâ”€â”€ InvalidTokenException.php
â”‚ â”‚ â”‚ â”œâ”€â”€ SetupTokenExpiredException.php # ğŸ”¥ First-access link has expired
â”‚ â”‚ â”‚ â””â”€â”€ PasswordAlreadySetException.php # ğŸ”¥ Attempt to reuse first-access link
â”‚ â”‚ â”‚
â”‚ â”‚ â””â”€â”€ Specifications/ # Specification Pattern (ğŸ§¬ #[NoDiscard] PHP 8.5)
â”‚ â”‚ â”œâ”€â”€ UserMustHaveUniqueEmail.php # ğŸ§¬ #[NoDiscard] on isSatisfiedBy()
â”‚ â”‚ â””â”€â”€ OtpMustNotBeExpired.php # ğŸ§¬ #[NoDiscard] on isSatisfiedBy()
â”‚ â”‚
â”‚ â”œâ”€â”€ Application/ # âš™ï¸ LAYER 2: Use Cases
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Commands/ # CQRS - Write Operations (ğŸ”¥ MUST dispatch Domain Events for mutation)
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ SendOtp/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ SendOtpCommand.php
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ SendOtpHandler.php
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ VerifyOtp/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ VerifyOtpCommand.php
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ VerifyOtpHandler.php
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ RegisterUser/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ RegisterUserCommand.php
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ RegisterUserHandler.php
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ Login/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ LoginCommand.php
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ LoginHandler.php
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ LoginWithOtp/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ LoginWithOtpCommand.php
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ LoginWithOtpHandler.php
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ Logout/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ LogoutCommand.php
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ LogoutHandler.php
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ RefreshToken/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ RefreshTokenCommand.php
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ RefreshTokenHandler.php
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ ChangePassword/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ ChangePasswordCommand.php
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ ChangePasswordHandler.php
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ ResetPassword/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ RequestPasswordResetCommand.php
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ RequestPasswordResetHandler.php
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ ResetPasswordCommand.php
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ ResetPasswordHandler.php
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ SetFirstTimePassword/ # ğŸ”¥ User follows link and sets their password for the first time
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ SetFirstTimePasswordCommand.php
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ SetFirstTimePasswordHandler.php
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â””â”€â”€ RevokeSession/
â”‚ â”‚ â”‚ â”œâ”€â”€ RevokeSessionCommand.php
â”‚ â”‚ â”‚ â””â”€â”€ RevokeSessionHandler.php
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Queries/ # CQRS - Read Operations (ğŸ”¥ MUST implement Cache::remember with TTL)
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ GetUser/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ GetUserQuery.php
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ GetUserHandler.php
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ GetUserByEmail/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ GetUserByEmailQuery.php
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ GetUserByEmailHandler.php
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ GetActiveSessions/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ GetActiveSessionsQuery.php
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ GetActiveSessionsHandler.php
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ VerifyToken/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ VerifyTokenQuery.php
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ VerifyTokenHandler.php
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ GetUserPermissions/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ GetUserPermissionsQuery.php
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ GetUserPermissionsHandler.php
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â””â”€â”€ ReadModels/ # ğŸ”¥ CQRS Read Models (moved from Infrastructure)
â”‚ â”‚ â”‚ â”œâ”€â”€ UserReadModel.php
â”‚ â”‚ â”‚ â””â”€â”€ SessionReadModel.php
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ EventHandlers/ # Event Handlers (async, post-commit)
â”‚ â”‚ â”‚ â”œâ”€â”€ OnOtpGenerated.php
â”‚ â”‚ â”‚ â”œâ”€â”€ OnOtpVerified.php
â”‚ â”‚ â”‚ â”œâ”€â”€ OnUserRegistered.php
â”‚ â”‚ â”‚ â”œâ”€â”€ OnUserLoggedIn.php
â”‚ â”‚ â”‚ â”œâ”€â”€ OnPasswordChanged.php
â”‚ â”‚ â”‚ â””â”€â”€ OnSessionExpired.php
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ IntegrationEvents/ # ğŸ”¥ Events this context publishes to others
â”‚ â”‚ â”‚ â”œâ”€â”€ UserRegisteredIntegration.php
â”‚ â”‚ â”‚ â”œâ”€â”€ UserAuthenticatedIntegration.php
â”‚ â”‚ â”‚ â””â”€â”€ PasswordChangedIntegration.php
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ ACL/ # ğŸ”¥ Anti-Corruption Layer
â”‚ â”‚ â”‚ â””â”€â”€ UserFromNotificationsACL.php # Translates models from Notifications â†’ Auth
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Services/ # Application Services (thin orchestrators)
â”‚ â”‚ â”‚ â”œâ”€â”€ AuthenticationService.php # ğŸ”¥ Orchestrates Fortify + Sanctum
â”‚ â”‚ â”‚ â”œâ”€â”€ PermissionService.php # ğŸ”¥ Wraps spatie/laravel-permission
â”‚ â”‚ â”‚ â””â”€â”€ AuthorizationService.php # ğŸ”¥ Evaluates Gates + Policies in Application layer
â”‚ â”‚ â”‚
â”‚ â”‚ â””â”€â”€ Permissions/ # ğŸ”¥ Permission Management (spatie/permission)
â”‚ â”‚ â”œâ”€â”€ SyncPermissionsCommand.php # Sync DB permissions with code
â”‚ â”‚ â”œâ”€â”€ RoleDefinitions.php # Declarative list of system roles
â”‚ â”‚ â””â”€â”€ PermissionDefinitions.php # Declarative list of system permissions
â”‚ â”‚
â”‚ â””â”€â”€ Infrastructure/ # ğŸ”Œ LAYER 3: Adapters
â”‚ â”‚
â”‚ â”œâ”€â”€ Adapters/ # ğŸ”¥ All external adapters
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Http/ # REST API Adapter
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ Controllers/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ Api/ # API Controllers
â”‚ â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ AuthController.php
â”‚ â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ OtpController.php
â”‚ â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ SessionController.php
â”‚ â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ SetupPasswordController.php # ğŸ”¥ GET+POST /auth/setup-password/{token} â€” first access & admin reset
â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€ UserController.php
â”‚ â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ Web/ # Inertia Controllers
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ LoginPageController.php
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ RegisterPageController.php
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ DashboardController.php
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ ProfileController.php
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ Requests/ # Form Requests (Validation)
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ SendOtpRequest.php
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ VerifyOtpRequest.php
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ LoginRequest.php
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ RegisterRequest.php
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ ChangePasswordRequest.php
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ ResetPasswordRequest.php
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ SetFirstTimePasswordRequest.php # ğŸ”¥ Password validation for first-time access / admin reset
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ Resources/ # API Resources (JSON Serialization)
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ UserResource.php
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ SessionResource.php
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ UserCollection.php
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ PermissionResource.php
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ Middleware/ # Context-specific Middleware
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ OtpRateLimitMiddleware.php
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ EnsureEmailIsVerified.php
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ CheckSessionValidity.php
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â””â”€â”€ Responses/ # HTTP Responses
â”‚ â”‚ â”‚ â”œâ”€â”€ AuthSuccessResponse.php
â”‚ â”‚ â”‚ â””â”€â”€ OtpSentResponse.php
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ WebSocket/ # ğŸ”¥ WebSocket Adapter (Reverb)
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ Channels/ # WebSocket Channels
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ UserChannel.php
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ SessionChannel.php
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ PresenceChannel.php
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ Events/ # Broadcast Events
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ UserLoggedInBroadcast.php
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ SessionExpiredBroadcast.php
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ OtpSentBroadcast.php
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ NewDeviceLoginBroadcast.php
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ Listeners/ # WebSocket Event Listeners
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ BroadcastUserLogin.php
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ BroadcastSessionExpiry.php
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ BroadcastOtpSent.php
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ Middleware/
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ AuthorizeWebSocketMiddleware.php
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â””â”€â”€ Config/
â”‚ â”‚ â”‚ â””â”€â”€ channels.php # Channel definitions
â”‚ â”‚ â”‚
â”‚ â”‚ â””â”€â”€ CLI/ # CLI Adapter (Artisan Commands)
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Commands/
â”‚ â”‚ â”‚ â”œâ”€â”€ CleanExpiredOtpCommand.php
â”‚ â”‚ â”‚ â”œâ”€â”€ CleanExpiredSessionsCommand.php
â”‚ â”‚ â”‚ â”œâ”€â”€ GenerateApiTokenCommand.php
â”‚ â”‚ â”‚ â””â”€â”€ Maintenance/
â”‚ â”‚ â”‚ â”œâ”€â”€ ClearAllCachesCommand.php
â”‚ â”‚ â”‚ â”œâ”€â”€ OptimizeProductionCommand.php
â”‚ â”‚ â”‚ â””â”€â”€ WarmUpCacheCommand.php
â”‚ â”‚ â”‚
â”‚ â”‚ â””â”€â”€ Kernel/
â”‚ â”‚ â””â”€â”€ AuthConsoleKernel.php
â”‚ â”‚
â”‚ â”œâ”€â”€ Persistence/ # Persistence
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Eloquent/ # Eloquent ORM
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ Models/ # Eloquent Models (ğŸ”¥ MUST use Spatie\Activitylog\Traits\LogsActivity)
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ OtpEloquentModel.php # @internal â€” Infrastructure only. Use OtpRepositoryPort.
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ UserEloquentModel.php # @internal â€” Infrastructure only. Use UserRepositoryPort.
â”‚ â”‚ â”‚ â”‚ â”‚ # HasRoles (spatie/permission), HasApiTokens (sanctum)
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ SessionEloquentModel.php # @internal â€” Infrastructure only. Use SessionRepositoryPort.
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ RefreshTokenEloquentModel.php # @internal â€” Infrastructure only.
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ Migrations/ # Database Migrations
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ 2024_01_create_otp_codes_table.php
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ 2024_02_create_users_table.php
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ 2024_03_create_sessions_table.php
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ 2024_04_create_refresh_tokens_table.php
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ Seeders/ # Database Seeders
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ RolesSeeder.php # ğŸ”¥ Uses spatie/laravel-permission
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ PermissionsSeeder.php # ğŸ”¥ Uses spatie/laravel-permission
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ DefaultUsersSeeder.php
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â””â”€â”€ Factories/ # Model Factories (PEST tests)
â”‚ â”‚ â”‚ â”œâ”€â”€ UserFactory.php
â”‚ â”‚ â”‚ â””â”€â”€ OtpFactory.php
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Repositories/ # Repository Implementations
â”‚ â”‚ â”‚ â”œâ”€â”€ EloquentOtpRepository.php
â”‚ â”‚ â”‚ â”œâ”€â”€ EloquentUserRepository.php
â”‚ â”‚ â”‚ â”œâ”€â”€ EloquentSessionRepository.php
â”‚ â”‚ â”‚ â””â”€â”€ EloquentRefreshTokenRepository.php
â”‚ â”‚ â”‚
â”‚ â”‚ â””â”€â”€ Mappers/ # ğŸ”¥ Eloquent â†” Domain Mappers
â”‚ â”‚ â”œâ”€â”€ OtpMapper.php
â”‚ â”‚ â”œâ”€â”€ UserMapper.php
â”‚ â”‚ â”œâ”€â”€ SessionMapper.php
â”‚ â”‚ â””â”€â”€ RefreshTokenMapper.php
â”‚ â”‚ # ğŸ”¥ ReadModels moved to Application/Queries/ReadModels/ (pure CQRS)
â”‚ â”‚
â”‚ â”œâ”€â”€ Queue/ # ğŸ”¥ Queue Jobs (separate from adapters)
â”‚ â”‚ â”œâ”€â”€ Jobs/
â”‚ â”‚ â”‚ â”œâ”€â”€ SendOtpSmsJob.php
â”‚ â”‚ â”‚ â”œâ”€â”€ SendOtpEmailJob.php
â”‚ â”‚ â”‚ â”œâ”€â”€ CleanExpiredOtpJob.php
â”‚ â”‚ â”‚ â”œâ”€â”€ CleanExpiredSessionsJob.php
â”‚ â”‚ â”‚ â”œâ”€â”€ SendPasswordResetEmailJob.php
â”‚ â”‚ â”‚ â”œâ”€â”€ SendWelcomeSetupEmailJob.php # ğŸ”¥ Welcome email with first-access link (registration)
â”‚ â”‚ â”‚ â””â”€â”€ SendAdminPasswordResetEmailJob.php # ğŸ”¥ Email sent when Super Admin resets a password
â”‚ â”‚ â”‚
â”‚ â”‚ â””â”€â”€ Handlers/ # Application-level handlers
â”‚ â”‚ â”œâ”€â”€ SendOtpSmsHandler.php
â”‚ â”‚ â””â”€â”€ SendOtpEmailHandler.php
â”‚ â”‚
â”‚ â”œâ”€â”€ ExternalServices/ # External Services Adapters
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Notifications/ # Notification Services
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ SMS/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ SmsGatewayInterface.php
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ TwilioAdapter.php
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ VonageAdapter.php # ğŸ”¥ Integrates with spatie OTP via SMS
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ MessageBirdAdapter.php
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ AwsSnsAdapter.php
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â””â”€â”€ Email/
â”‚ â”‚ â”‚ â”œâ”€â”€ EmailServiceInterface.php
â”‚ â”‚ â”‚ â”œâ”€â”€ MailgunAdapter.php
â”‚ â”‚ â”‚ â”œâ”€â”€ SendGridAdapter.php
â”‚ â”‚ â”‚ â”œâ”€â”€ SesAdapter.php
â”‚ â”‚ â”‚ â”œâ”€â”€ ResendAdapter.php # ğŸ”¥ resend/resend-laravel
â”‚ â”‚ â”‚ â””â”€â”€ ReactEmailTemplateRenderer.php # ğŸ”¥ React Email templates (optional)
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ OAuth/ # OAuth Providers (laravel/socialite)
â”‚ â”‚ â”‚ â”œâ”€â”€ OAuthProviderInterface.php
â”‚ â”‚ â”‚ â”œâ”€â”€ GoogleOAuthAdapter.php
â”‚ â”‚ â”‚ â”œâ”€â”€ FacebookOAuthAdapter.php
â”‚ â”‚ â”‚ â”œâ”€â”€ GithubOAuthAdapter.php
â”‚ â”‚ â”‚ â””â”€â”€ MicrosoftOAuthAdapter.php
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Analytics/ # Analytics Services
â”‚ â”‚ â”‚ â”œâ”€â”€ AnalyticsInterface.php
â”‚ â”‚ â”‚ â”œâ”€â”€ GoogleAnalyticsAdapter.php
â”‚ â”‚ â”‚ â””â”€â”€ MixpanelAdapter.php
â”‚ â”‚ â”‚
â”‚ â”‚ â””â”€â”€ Security/ # Security Services
â”‚ â”‚ â”œâ”€â”€ IpGeolocation/
â”‚ â”‚ â”‚ â”œâ”€â”€ IpGeolocationInterface.php
â”‚ â”‚ â”‚ â””â”€â”€ IpApiAdapter.php
â”‚ â”‚ â”‚
â”‚ â”‚ â””â”€â”€ FraudDetection/
â”‚ â”‚ â”œâ”€â”€ FraudDetectionInterface.php
â”‚ â”‚ â””â”€â”€ SiftScienceAdapter.php
â”‚ â”‚
â”‚ â”œâ”€â”€ Cache/ # Cache specific to context
â”‚ â”‚ â”œâ”€â”€ UserCacheRepository.php
â”‚ â”‚ â””â”€â”€ SessionCacheRepository.php
â”‚ â”‚
â”‚ â”œâ”€â”€ Routes/ # Context routes
â”‚ â”‚ â”œâ”€â”€ api.php # API Routes
â”‚ â”‚ â”œâ”€â”€ web.php # Web/Inertia Routes
â”‚ â”‚ â”œâ”€â”€ channels.php # ğŸ”¥ Broadcasting Channels (Reverb)
â”‚ â”‚ â””â”€â”€ console.php # Console Routes
â”‚ â”‚
â”‚ â””â”€â”€ Views/ # Views (if using Blade instead of Inertia)
â”‚ â”œâ”€â”€ emails/
â”‚ â”‚ â”œâ”€â”€ otp.blade.php
â”‚ â”‚ â””â”€â”€ welcome.blade.php
â”‚ â””â”€â”€ auth/
â”‚ â””â”€â”€ login.blade.php
â”‚
â”‚
â”œâ”€â”€ Users/ # ğŸ‘¤ CONTEXT: User Management (full CRUD â€” base template)
â”‚ â”‚
â”‚ â”œâ”€â”€ Providers/
â”‚ â”‚ â””â”€â”€ UsersServiceProvider.php
â”‚ â”‚
â”‚ â”œâ”€â”€ Config/
â”‚ â”‚ â””â”€â”€ users.php
â”‚ â”‚
â”‚ â”œâ”€â”€ Contracts/ # ğŸ”¥ Published Language (context public API)
â”‚ â”‚ â””â”€â”€ DTOs/
â”‚ â”‚ â””â”€â”€ UserSummaryDTO.php # DTO exposed to other contexts (does not expose internal entity)
â”‚ â”‚
â”‚ â”œâ”€â”€ Tests/
â”‚ â”‚ â”œâ”€â”€ Unit/
â”‚ â”‚ â”‚ â”œâ”€â”€ Domain/
â”‚ â”‚ â”‚ â””â”€â”€ Application/
â”‚ â”‚ â”œâ”€â”€ Integration/
â”‚ â”‚ â”‚ â””â”€â”€ Infrastructure/
â”‚ â”‚ â””â”€â”€ Feature/
â”‚ â”‚ â”œâ”€â”€ AdminCrudUserTest.php # ğŸ”¥ Super Admin creates, edits, suspends, deletes users
â”‚ â”‚ â”œâ”€â”€ SetFirstTimePasswordTest.php # ğŸ”¥ Full welcome flow â†’ link â†’ set password
â”‚ â”‚ â””â”€â”€ AdminResetPasswordTest.php # ğŸ”¥ Admin resets password â†’ email â†’ user sets new one
â”‚ â”‚
â”‚ â”œâ”€â”€ Domain/
â”‚ â”‚ â”œâ”€â”€ Entities/
â”‚ â”‚ â”‚ â”œâ”€â”€ User.php # ğŸ§¬ #[Override] $id: UserId â€” root entity for this context
â”‚ â”‚ â”‚ â”œâ”€â”€ UserProfile.php
â”‚ â”‚ â”‚ â”œâ”€â”€ UserPreferences.php
â”‚ â”‚ â”‚ â””â”€â”€ UserActivity.php
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ ValueObjects/
â”‚ â”‚ â”‚ â”œâ”€â”€ UserId.php # ğŸ§¬ readonly + clone with
â”‚ â”‚ â”‚ â”œâ”€â”€ FullName.php # ğŸ§¬ readonly + clone with
â”‚ â”‚ â”‚ â”œâ”€â”€ Avatar.php # ğŸ§¬ readonly + clone with
â”‚ â”‚ â”‚ â”œâ”€â”€ Bio.php # ğŸ§¬ readonly + clone with
â”‚ â”‚ â”‚ â””â”€â”€ SocialLinks.php # ğŸ§¬ readonly + clone with
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Enums/ # ğŸ”¥ PHP 8.1+ Enums
â”‚ â”‚ â”‚ â”œâ”€â”€ UserStatus.php # active, suspended, banned, deleted
â”‚ â”‚ â”‚ â””â”€â”€ ProfileVisibility.php # public, private, friends_only
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Ports/
â”‚ â”‚ â”‚ â”œâ”€â”€ UserRepositoryPort.php # ğŸ”¥ Main port â€” full CRUD
â”‚ â”‚ â”‚ â”œâ”€â”€ UserProfileRepositoryPort.php
â”‚ â”‚ â”‚ â””â”€â”€ UserActivityRepositoryPort.php
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Services/
â”‚ â”‚ â”‚ â”œâ”€â”€ UserProfileManager.php # ğŸ§¬ #[NoDiscard]
â”‚ â”‚ â”‚ â””â”€â”€ UserStatusManager.php # ğŸ”¥ Business logic: suspend, ban, activate
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Policies/ # ğŸ”¥ Domain Policies
â”‚ â”‚ â”‚ â””â”€â”€ CanManageUsersPolicy.php # Only SuperAdmin can create/delete users
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Events/
â”‚ â”‚ â”‚ â”œâ”€â”€ UserCreatedByAdmin.php # ğŸ”¥ Admin created user â†’ triggers welcome email
â”‚ â”‚ â”‚ â”œâ”€â”€ ProfileUpdated.php
â”‚ â”‚ â”‚ â”œâ”€â”€ AvatarChanged.php
â”‚ â”‚ â”‚ â”œâ”€â”€ UserSuspended.php
â”‚ â”‚ â”‚ â”œâ”€â”€ UserActivated.php
â”‚ â”‚ â”‚ â””â”€â”€ UserDeleted.php
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Subscribers/ # ğŸ”¥ Synchronous reactions
â”‚ â”‚ â”‚ â””â”€â”€ InvalidateUserCacheOnUpdate.php
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Specifications/ # ğŸ§¬ #[NoDiscard] PHP 8.5
â”‚ â”‚ â”‚ â””â”€â”€ UserEmailMustBeUnique.php # ğŸ§¬ #[NoDiscard] on isSatisfiedBy()
â”‚ â”‚ â”‚
â”‚ â”‚ â””â”€â”€ Exceptions/
â”‚ â”‚ â”œâ”€â”€ UserNotFoundException.php
â”‚ â”‚ â”œâ”€â”€ UserAlreadyExistsException.php
â”‚ â”‚ â”œâ”€â”€ ProfileNotFoundException.php
â”‚ â”‚ â””â”€â”€ InvalidAvatarException.php
â”‚ â”‚
â”‚ â”œâ”€â”€ Application/
â”‚ â”‚ â”œâ”€â”€ Commands/
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ CreateUser/ # ğŸ”¥ Super Admin creates user â†’ sends welcome email with setup link
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ CreateUserCommand.php # name, email, role â€” no password (user defines it)
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ CreateUserHandler.php # Creates user with status=pending_setup â†’ triggers WelcomeSetupEmail
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ UpdateUser/ # ğŸ”¥ Super Admin edits user data
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ UpdateUserCommand.php # name, email, role, status
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ UpdateUserHandler.php
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ AdminResetPassword/ # ğŸ”¥ Super Admin forces password reset â†’ sends email to user
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ AdminResetPasswordCommand.php # userId â€” generates SetupToken and sends email
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ AdminResetPasswordHandler.php # Invalidates current password â†’ new token â†’ email
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ SuspendUser/ # ğŸ”¥ Super Admin suspends user
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ SuspendUserCommand.php
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ SuspendUserHandler.php
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ ActivateUser/ # ğŸ”¥ Super Admin reactivates suspended user
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ ActivateUserCommand.php
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ ActivateUserHandler.php
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ DeleteUser/ # ğŸ”¥ Soft delete
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ DeleteUserCommand.php
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ DeleteUserHandler.php
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ UpdateProfile/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ UpdateProfileCommand.php
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ UpdateProfileHandler.php
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â””â”€â”€ UploadAvatar/
â”‚ â”‚ â”‚ â”œâ”€â”€ UploadAvatarCommand.php
â”‚ â”‚ â”‚ â””â”€â”€ UploadAvatarHandler.php
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Queries/
â”‚ â”‚ â”‚ â”œâ”€â”€ GetUser/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ GetUserQuery.php
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ GetUserHandler.php
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ ListUsers/ # ğŸ”¥ Paginated list with filters for Super Admin
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ ListUsersQuery.php # filters: status, role, search, dateRange
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ ListUsersHandler.php
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ GetUserProfile/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ GetUserProfileQuery.php
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ GetUserProfileHandler.php
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ GetUserActivity/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ GetUserActivityQuery.php
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ GetUserActivityHandler.php
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ SearchUsers/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ SearchUsersQuery.php
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ SearchUsersHandler.php
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â””â”€â”€ ReadModels/ # ğŸ”¥ CQRS Read Models
â”‚ â”‚ â”‚ â”œâ”€â”€ UserReadModel.php
â”‚ â”‚ â”‚ â”œâ”€â”€ UserListReadModel.php # ğŸ”¥ Optimized view for admin table
â”‚ â”‚ â”‚ â””â”€â”€ UserProfileReadModel.php
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ DTOs/
â”‚ â”‚ â”‚ â”œâ”€â”€ CreateUserDTO.php
â”‚ â”‚ â”‚ â”œâ”€â”€ UpdateUserDTO.php
â”‚ â”‚ â”‚ â””â”€â”€ UserFilterDTO.php
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ IntegrationEvents/ # ğŸ”¥ Events published by this context
â”‚ â”‚ â”‚ â”œâ”€â”€ UserCreatedIntegration.php # ğŸ”¥ Notifies Auth context to create credentials
â”‚ â”‚ â”‚ â”œâ”€â”€ ProfileUpdatedIntegration.php
â”‚ â”‚ â”‚ â””â”€â”€ UserDeletedIntegration.php
â”‚ â”‚ â”‚
â”‚ â”‚ â””â”€â”€ EventHandlers/
â”‚ â”‚ â”œâ”€â”€ OnUserCreatedByAdmin.php # ğŸ”¥ Listens to UserCreatedByAdmin â†’ dispatches WelcomeSetupEmailJob
â”‚ â”‚ â”œâ”€â”€ OnProfileUpdated.php
â”‚ â”‚ â””â”€â”€ OnUserDeleted.php
â”‚ â”‚
â”‚ â””â”€â”€ Infrastructure/
â”‚ â”œâ”€â”€ Adapters/
â”‚ â”‚ â”œâ”€â”€ Http/
â”‚ â”‚ â”‚ â”œâ”€â”€ Controllers/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ Api/
â”‚ â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ AdminUserController.php # ğŸ”¥ Full CRUD â€” SuperAdmin only
â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ # GET /api/admin/users (index)
â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ # POST /api/admin/users (store â€” creates user + sends email)
â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ # GET /api/admin/users/{id} (show)
â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ # PUT /api/admin/users/{id} (update)
â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ # DELETE /api/admin/users/{id} (destroy)
â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ # POST /api/admin/users/{id}/suspend
â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ # POST /api/admin/users/{id}/activate
â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ # POST /api/admin/users/{id}/reset-password (sends reset email)
â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€ UserProfileController.php # Authenticated user's own profile
â”‚ â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ Web/
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ ProfilePageController.php
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ Requests/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ CreateUserRequest.php # ğŸ”¥ name, email, role â€” no password (user sets it)
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ UpdateUserRequest.php # ğŸ”¥ name, email, role, status
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ UpdateProfileRequest.php
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ UploadAvatarRequest.php
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â””â”€â”€ Resources/
â”‚ â”‚ â”‚ â”œâ”€â”€ UserResource.php # ğŸ”¥ Includes setup_status for admin
â”‚ â”‚ â”‚ â”œâ”€â”€ UserListResource.php # ğŸ”¥ Compact version for admin table
â”‚ â”‚ â”‚ â”œâ”€â”€ UserProfileResource.php
â”‚ â”‚ â”‚ â”œâ”€â”€ UserCollection.php
â”‚ â”‚ â”‚ â””â”€â”€ UserActivityResource.php
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ WebSocket/ # ğŸ”¥ WebSocket for Users (Reverb)
â”‚ â”‚ â”‚ â”œâ”€â”€ Channels/
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ UserPresenceChannel.php
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ Events/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ ProfileUpdatedBroadcast.php
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ UserStatusChangedBroadcast.php
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â””â”€â”€ Listeners/
â”‚ â”‚ â”‚ â””â”€â”€ BroadcastProfileUpdate.php
â”‚ â”‚ â”‚
â”‚ â”‚ â””â”€â”€ CLI/
â”‚ â”‚ â””â”€â”€ Commands/
â”‚ â”‚ â”œâ”€â”€ SyncUserDataCommand.php
â”‚ â”‚ â””â”€â”€ ResendSetupEmailCommand.php # ğŸ”¥ Resends welcome email to pending_setup users
â”‚ â”‚
â”‚ â”œâ”€â”€ Persistence/
â”‚ â”‚ â”œâ”€â”€ Eloquent/
â”‚ â”‚ â”‚ â”œâ”€â”€ Models/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ UserEloquentModel.php # @internal â€” Infrastructure only. Use UserRepositoryPort.
â”‚ â”‚ â”‚ â”‚ â”‚ # HasRoles (spatie), HasApiTokens (sanctum), SoftDeletes
â”‚ â”‚ â”‚ â”‚ â”‚ # setup_status: pending_setup | active
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ UserProfileEloquentModel.php # @internal â€” Infrastructure only.
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ UserActivityEloquentModel.php # @internal â€” Infrastructure only.
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ Migrations/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ 2026_01_create_users_table.php # ğŸ”¥ +setup_status, +setup_token_expires_at
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ 2026_02_create_user_profiles_table.php
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ 2026_03_create_user_activities_table.php
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ Seeders/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ SuperAdminSeeder.php # ğŸ”¥ Creates the first Super Admin
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ UsersSeeder.php
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â””â”€â”€ Factories/
â”‚ â”‚ â”‚ â””â”€â”€ UserFactory.php # For PEST tests
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Repositories/
â”‚ â”‚ â”‚ â”œâ”€â”€ EloquentUserRepository.php # Implements UserRepositoryPort
â”‚ â”‚ â”‚ â”œâ”€â”€ EloquentUserProfileRepository.php
â”‚ â”‚ â”‚ â””â”€â”€ EloquentUserActivityRepository.php
â”‚ â”‚ â”‚
â”‚ â”‚ â””â”€â”€ Mappers/
â”‚ â”‚ â”œâ”€â”€ UserMapper.php
â”‚ â”‚ â”œâ”€â”€ UserProfileMapper.php
â”‚ â”‚ â””â”€â”€ UserActivityMapper.php
â”‚ â”‚
â”‚ â”œâ”€â”€ Queue/
â”‚ â”‚ â””â”€â”€ Jobs/
â”‚ â”‚ â”œâ”€â”€ ProcessAvatarJob.php # ğŸ”¥ Uses intervention/image
â”‚ â”‚ â””â”€â”€ GenerateThumbnailsJob.php # ğŸ”¥ Uses intervention/image
â”‚ â”‚
â”‚ â”œâ”€â”€ ExternalServices/
â”‚ â”‚ â””â”€â”€ Storage/
â”‚ â”‚ â”œâ”€â”€ StorageInterface.php
â”‚ â”‚ â”œâ”€â”€ S3StorageAdapter.php # ğŸ”¥ league/flysystem-aws-s3-v3
â”‚ â”‚ â”œâ”€â”€ LocalStorageAdapter.php
â”‚ â”‚ â”œâ”€â”€ CloudinaryAdapter.php
â”‚ â”‚ â””â”€â”€ SpatieMediaLibraryAdapter.php # ğŸ”¥ spatie/laravel-medialibrary
â”‚ â”‚
â”‚ â”œâ”€â”€ Cache/
â”‚ â”‚ â””â”€â”€ UserCacheRepository.php
â”‚ â”‚
â”‚ â””â”€â”€ Routes/
â”‚ â”œâ”€â”€ api.php # ğŸ”¥ Includes /admin/users/\* routes protected by role:super-admin
â”‚ â”œâ”€â”€ web.php
â”‚ â””â”€â”€ channels.php # ğŸ”¥ Reverb channels
â”‚
â”‚
â”œâ”€â”€ Notifications/ # ğŸ“§ CONTEXT: Notifications
â”‚ â”‚
â”‚ â”œâ”€â”€ Providers/
â”‚ â”‚ â””â”€â”€ NotificationsServiceProvider.php
â”‚ â”‚
â”‚ â”œâ”€â”€ Config/
â”‚ â”‚ â””â”€â”€ notifications.php
â”‚ â”‚
â”‚ â”œâ”€â”€ Contracts/ # ğŸ”¥ Published Language (context public API)
â”‚ â”‚ â””â”€â”€ DTOs/
â”‚ â”‚ â””â”€â”€ NotificationSummaryDTO.php # DTO exposed to other contexts
â”‚ â”‚
â”‚ â”œâ”€â”€ Tests/
â”‚ â”‚ â”œâ”€â”€ Unit/
â”‚ â”‚ â”‚ â”œâ”€â”€ Domain/
â”‚ â”‚ â”‚ â””â”€â”€ Application/
â”‚ â”‚ â”œâ”€â”€ Integration/
â”‚ â”‚ â”‚ â””â”€â”€ Infrastructure/
â”‚ â”‚ â””â”€â”€ Feature/
â”‚ â”‚ â”œâ”€â”€ SendNotificationTest.php
â”‚ â”‚ â””â”€â”€ RealtimeNotificationTest.php # ğŸ”¥ WebSocket delivery tests
â”‚ â”‚
â”‚ â”œâ”€â”€ Domain/
â”‚ â”‚ â”œâ”€â”€ Entities/
â”‚ â”‚ â”‚ â”œâ”€â”€ Notification.php
â”‚ â”‚ â”‚ â””â”€â”€ NotificationPreference.php
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ ValueObjects/
â”‚ â”‚ â”‚ â”œâ”€â”€ NotificationType.php
â”‚ â”‚ â”‚ â””â”€â”€ NotificationChannel.php
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Enums/ # ğŸ”¥ PHP 8.1+ Enums
â”‚ â”‚ â”‚ â”œâ”€â”€ NotificationStatus.php # pending, sent, read, failed
â”‚ â”‚ â”‚ â””â”€â”€ DeliveryChannel.php # email, sms, push, in_app, websocket
â”‚ â”‚ â”‚
â”‚ â”‚ â””â”€â”€ Ports/
â”‚ â”‚ â””â”€â”€ NotificationRepositoryPort.php
â”‚ â”‚
â”‚ â”œâ”€â”€ Application/
â”‚ â”‚ â”œâ”€â”€ Commands/
â”‚ â”‚ â”‚ â””â”€â”€ SendNotification/
â”‚ â”‚ â”‚
â”‚ â”‚ â””â”€â”€ Queries/
â”‚ â”‚ â””â”€â”€ GetUserNotifications/
â”‚ â”‚
â”‚ â””â”€â”€ Infrastructure/
â”‚ â”œâ”€â”€ Adapters/
â”‚ â”‚ â”œâ”€â”€ Http/
â”‚ â”‚ â”‚ â””â”€â”€ Controllers/
â”‚ â”‚ â”‚ â””â”€â”€ NotificationController.php
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ WebSocket/ # ğŸ”¥ Real-time notifications (Reverb)
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ Channels/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ NotificationChannel.php
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ UserNotificationChannel.php
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ Events/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ NotificationSentBroadcast.php
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ NotificationReadBroadcast.php
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â””â”€â”€ Listeners/
â”‚ â”‚ â”‚ â””â”€â”€ BroadcastNotificationSent.php
â”‚ â”‚ â”‚
â”‚ â”‚ â””â”€â”€ CLI/
â”‚ â”‚ â””â”€â”€ Commands/
â”‚ â”‚ â””â”€â”€ SendBulkNotificationsCommand.php
â”‚ â”‚
â”‚ â”œâ”€â”€ Persistence/
â”‚ â”‚ â”œâ”€â”€ Eloquent/
â”‚ â”‚ â”‚ â”œâ”€â”€ Models/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ NotificationEloquentModel.php # @internal â€” Infrastructure only. Use NotificationRepositoryPort.
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ NotificationPreferenceEloquentModel.php # @internal â€” Infrastructure only.
â”‚ â”‚ â”‚ â”œâ”€â”€ Migrations/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ 2026_01_create_notifications_table.php
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ 2026_02_create_notification_preferences_table.php
â”‚ â”‚ â”‚ â””â”€â”€ Factories/
â”‚ â”‚ â”‚ â””â”€â”€ NotificationFactory.php
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Repositories/
â”‚ â”‚ â”‚ â””â”€â”€ EloquentNotificationRepository.php # Implements NotificationRepositoryPort
â”‚ â”‚ â”‚
â”‚ â”‚ â””â”€â”€ Mappers/ # ğŸ”¥ Eloquent â†” Domain Mappers
â”‚ â”‚ â””â”€â”€ NotificationMapper.php
â”‚ â”‚
â”‚ â”œâ”€â”€ Queue/
â”‚ â”‚ â””â”€â”€ Jobs/
â”‚ â”‚ â””â”€â”€ SendNotificationJob.php
â”‚ â”‚
â”‚ â”œâ”€â”€ ExternalServices/
â”‚ â”‚ â”œâ”€â”€ Push/
â”‚ â”‚ â”‚ â”œâ”€â”€ FirebaseAdapter.php
â”‚ â”‚ â”‚ â””â”€â”€ OneSignalAdapter.php
â”‚ â”‚ â”‚
â”‚ â”‚ â””â”€â”€ Realtime/ # ğŸ”¥ Reverb as external service
â”‚ â”‚ â”œâ”€â”€ RealtimeNotificationInterface.php
â”‚ â”‚ â””â”€â”€ ReverbNotificationAdapter.php
â”‚ â”‚
â”‚ â””â”€â”€ Routes/
â”‚ â”œâ”€â”€ api.php
â”‚ â””â”€â”€ channels.php # ğŸ”¥ Reverb notification channels
â”‚
â”‚
â””â”€â”€ AI/ # ğŸ¤– CONTEXT: Artificial Intelligence
â”‚
â”œâ”€â”€ Providers/
â”‚ â””â”€â”€ AIServiceProvider.php
â”‚
â”œâ”€â”€ Config/
â”‚ â””â”€â”€ ai.php
â”‚
â”œâ”€â”€ Contracts/ # ğŸ”¥ Published Language (context public API)
â”‚ â””â”€â”€ DTOs/
â”‚ â”œâ”€â”€ GenerationResultDTO.php # DTO exposed to other contexts
â”‚ â””â”€â”€ AIModelInfoDTO.php
â”‚
â”œâ”€â”€ Tests/
â”‚ â”œâ”€â”€ Unit/
â”‚ â”‚ â”œâ”€â”€ Domain/
â”‚ â”‚ â””â”€â”€ Application/
â”‚ â”œâ”€â”€ Integration/
â”‚ â”‚ â””â”€â”€ Infrastructure/
â”‚ â””â”€â”€ Feature/
â”‚ â”œâ”€â”€ GenerateContentTest.php
â”‚ â”œâ”€â”€ AnalyzeTextTest.php
â”‚ â””â”€â”€ AIStreamingTest.php # ğŸ”¥ WebSocket streaming tests
â”‚
â”œâ”€â”€ Domain/
â”‚ â”œâ”€â”€ Ports/
â”‚ â”‚ â””â”€â”€ LLMProviderPort.php # Abstract interface for any LLM
â”‚ â”‚
â”‚ â”œâ”€â”€ ValueObjects/
â”‚ â”‚ â”œâ”€â”€ Prompt.php
â”‚ â”‚ â”œâ”€â”€ AIResponse.php
â”‚ â”‚ â””â”€â”€ StructuredSchema.php
â”‚ â”‚
â”‚ â”œâ”€â”€ Enums/ # ğŸ”¥ PHP 8.1+ Enums
â”‚ â”‚ â”œâ”€â”€ AIProvider.php # openai, anthropic, gemini, ollama
â”‚ â”‚ â””â”€â”€ ResponseFormat.php # text, structured, stream
â”‚ â”‚
â”‚ â””â”€â”€ Services/
â”‚ â”œâ”€â”€ ContentGenerator.php
â”‚ â””â”€â”€ TextAnalyzer.php
â”‚
â”œâ”€â”€ Application/
â”‚ â”œâ”€â”€ Commands/
â”‚ â”‚ â”œâ”€â”€ GenerateContent/
â”‚ â”‚ â”‚ â”œâ”€â”€ GenerateContentCommand.php
â”‚ â”‚ â”‚ â””â”€â”€ GenerateContentHandler.php
â”‚ â”‚ â”‚
â”‚ â”‚ â””â”€â”€ AnalyzeText/
â”‚ â”‚ â”œâ”€â”€ AnalyzeTextCommand.php
â”‚ â”‚ â””â”€â”€ AnalyzeTextHandler.php
â”‚ â”‚
â”‚ â””â”€â”€ Queries/
â”‚ â””â”€â”€ GetAIModels/
â”‚ â”œâ”€â”€ GetAIModelsQuery.php
â”‚ â””â”€â”€ GetAIModelsHandler.php
â”‚
â””â”€â”€ Infrastructure/
â”œâ”€â”€ Adapters/
â”‚ â”œâ”€â”€ Http/
â”‚ â”‚ â””â”€â”€ Controllers/
â”‚ â”‚ â””â”€â”€ AIController.php
â”‚ â”‚
â”‚ â””â”€â”€ WebSocket/ # ğŸ”¥ Real-time AI streaming (Reverb)
â”‚ â””â”€â”€ Events/
â”‚ â””â”€â”€ AIResponseStreamBroadcast.php
â”‚
â”œâ”€â”€ Persistence/
â”‚ â”œâ”€â”€ Eloquent/
â”‚ â”‚ â”œâ”€â”€ Models/
â”‚ â”‚ â”‚ â””â”€â”€ AIRequestLogEloquentModel.php # @internal â€” Infrastructure only. Audit log of AI calls.
â”‚ â”‚ â”œâ”€â”€ Migrations/
â”‚ â”‚ â”‚ â””â”€â”€ 2026_01_create_ai_request_logs_table.php
â”‚ â”‚ â””â”€â”€ Factories/
â”‚ â”‚ â””â”€â”€ AIRequestLogFactory.php
â”‚ â”‚
â”‚ â””â”€â”€ Repositories/
â”‚ â””â”€â”€ EloquentAIRequestLogRepository.php
â”‚
â”œâ”€â”€ Queue/
â”‚ â””â”€â”€ Jobs/
â”‚ â”œâ”€â”€ GenerateContentAsyncJob.php # ğŸ”¥ For long-running AI generation
â”‚ â””â”€â”€ AnalyzeTextAsyncJob.php
â”‚
â”œâ”€â”€ ExternalServices/
â”‚ â”œâ”€â”€ Prism/ # ğŸ”¥ prism-php/prism
â”‚ â”‚ â”œâ”€â”€ PrismLLMAdapter.php # Text, chat, conversation
â”‚ â”‚ â””â”€â”€ PrismStructuredAdapter.php # Structured output with DTOs
â”‚ â”‚
â”‚ â””â”€â”€ FastAPI/ # ğŸ”¥ Python microservice (heavy ML)
â”‚ â”œâ”€â”€ FastAPIClientInterface.php # ğŸ”¥ Contract for HTTP communication
â”‚ â”œâ”€â”€ FastAPIAdapter.php # ğŸ”¥ Implementation with Guzzle/Http
â”‚ â”œâ”€â”€ FastAPIHealthCheck.php # ğŸ”¥ Health check for the Python service
â”‚ â”œâ”€â”€ DTOs/
â”‚ â”‚ â”œâ”€â”€ PredictionRequestDTO.php # ğŸ”¥ Request to ML model
â”‚ â”‚ â”œâ”€â”€ PredictionResponseDTO.php # ğŸ”¥ Response from ML model
â”‚ â”‚ â””â”€â”€ ModelInfoDTO.php # ğŸ”¥ ML model metadata
â”‚ â”œâ”€â”€ Endpoints/ # ğŸ”¥ FastAPI route definitions
â”‚ â”‚ â”œâ”€â”€ PredictionEndpoint.php # POST /predict
â”‚ â”‚ â”œâ”€â”€ EmbeddingEndpoint.php # POST /embed
â”‚ â”‚ â”œâ”€â”€ ClassifyEndpoint.php # POST /classify
â”‚ â”‚ â””â”€â”€ TrainEndpoint.php # POST /train (fine-tuning)
â”‚ â””â”€â”€ Config/
â”‚ â””â”€â”€ fastapi.php # ğŸ”¥ base_url, timeout, retry, api_key
â”‚
â””â”€â”€ Routes/
â”œâ”€â”€ api.php
â””â”€â”€ channels.php # ğŸ”¥ AI streaming channels

    â”‚
    â””â”€â”€ {YourContext}/                               # â­ TEMPLATE â€” Replace with your real context
        â”‚   # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        â”‚   # HOW TO USE THIS TEMPLATE:
        â”‚   # 1. Duplicate this entire block for each new bounded context
        â”‚   # 2. Replace {YourContext} with the context name (e.g.: Orders, Products, Inventory)
        â”‚   # 3. Replace {YourEntity} with the main entity (e.g.: Order, Product, Item)
        â”‚   # 4. Replace {YourId} with the Value Object ID (e.g.: OrderId, ProductId)
        â”‚   # 5. Auth and Users contexts are the full reference â€” this template is the minimum
        â”‚   # 6. Register routes in Infrastructure/Routes/web.php
        â”‚   # 7. If the module requires user_id by relationship, add it as well as the belongsTo or hasMany from User to that table
        â”‚   # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        â”‚
        â”œâ”€â”€ Providers/
        â”‚   â””â”€â”€ {YourContext}ServiceProvider.php     # âš ï¸ REQUIRED: bind Ports â†’ Repositories in register()
        â”‚
        â”œâ”€â”€ Config/
        â”‚   â””â”€â”€ {your_context}.php
        â”‚
        â”œâ”€â”€ Contracts/                               # ğŸ”¥ Published Language â€” public API toward other contexts
        â”‚   â”œâ”€â”€ {YourContext}ServiceContract.php
        â”‚   â””â”€â”€ DTOs/
        â”‚       â””â”€â”€ {YourEntity}OutputDTO.php
        â”‚
        â”œâ”€â”€ Tests/
        â”‚   â”œâ”€â”€ Unit/
        â”‚   â”‚   â”œâ”€â”€ Domain/
        â”‚   â”‚   â””â”€â”€ Application/
        â”‚   â”œâ”€â”€ Integration/
        â”‚   â”‚   â””â”€â”€ Infrastructure/
        â”‚   â””â”€â”€ Feature/
        â”‚       â”œâ”€â”€ {YourEntity}CrudTest.php         # PEST: happy paths + validation + soft delete
        â”‚       â””â”€â”€ {YourEntity}ExportTest.php       # PEST: Excel + PDF export endpoints
        â”‚
        â”œâ”€â”€ Domain/                                  # â­ LAYER 1: Pure Domain
        â”‚   â”‚
        â”‚   â”œâ”€â”€ Entities/
        â”‚   â”‚   â””â”€â”€ {YourEntity}.php                 # ğŸ§¬ extends AggregateRoot, #[Override] $id: {YourId}
        â”‚   â”‚
        â”‚   â”œâ”€â”€ ValueObjects/
        â”‚   â”‚   â”œâ”€â”€ {YourId}.php                     # ğŸ§¬ readonly + clone with (ramsey/uuid)
        â”‚   â”‚   â””â”€â”€ ...                              # Other domain Value Objects
        â”‚   â”‚
        â”‚   â”œâ”€â”€ Enums/                               # ğŸ§¬ PHP 8.1+ Backed Enums
        â”‚   â”‚   â””â”€â”€ {YourEntity}Status.php           # e.g.: active, inactive, archived, deleted
        â”‚   â”‚
        â”‚   â”œâ”€â”€ Ports/                               # Repository interfaces
        â”‚   â”‚   â””â”€â”€ {YourEntity}RepositoryPort.php
        â”‚   â”‚
        â”‚   â”œâ”€â”€ Services/                            # ğŸ§¬ #[NoDiscard] â€” results must never be ignored
        â”‚   â”‚   â””â”€â”€ {YourEntity}DomainService.php
        â”‚   â”‚
        â”‚   â”œâ”€â”€ Policies/                            # Domain authorization
        â”‚   â”‚   â””â”€â”€ Can{Action}{YourEntity}Policy.php
        â”‚   â”‚
        â”‚   â”œâ”€â”€ Events/                              # Domain Events
        â”‚   â”‚   â”œâ”€â”€ {YourEntity}Created.php
        â”‚   â”‚   â”œâ”€â”€ {YourEntity}Updated.php
        â”‚   â”‚   â””â”€â”€ {YourEntity}Deleted.php
        â”‚   â”‚
        â”‚   â”œâ”€â”€ Subscribers/                         # Synchronous reactions (same transaction)
        â”‚   â”‚   â””â”€â”€ On{YourEntity}Deleted.php
        â”‚   â”‚
        â”‚   â”œâ”€â”€ Specifications/                      # ğŸ§¬ #[NoDiscard] on isSatisfiedBy()
        â”‚   â”‚   â””â”€â”€ {YourEntity}MustBeUnique.php
        â”‚   â”‚
        â”‚   â””â”€â”€ Exceptions/
        â”‚       â”œâ”€â”€ {YourEntity}NotFoundException.php
        â”‚       â””â”€â”€ {YourEntity}AlreadyExistsException.php
        â”‚
        â”œâ”€â”€ Application/                             # âš™ï¸ LAYER 2: Use Cases (CQRS)
        â”‚   â”‚
        â”‚   â”œâ”€â”€ Commands/                            # Write operations
        â”‚   â”‚   â”œâ”€â”€ Create{YourEntity}/
        â”‚   â”‚   â”‚   â”œâ”€â”€ Create{YourEntity}Command.php
        â”‚   â”‚   â”‚   â””â”€â”€ Create{YourEntity}Handler.php
        â”‚   â”‚   â”œâ”€â”€ Update{YourEntity}/
        â”‚   â”‚   â”‚   â”œâ”€â”€ Update{YourEntity}Command.php
        â”‚   â”‚   â”‚   â””â”€â”€ Update{YourEntity}Handler.php
        â”‚   â”‚   â””â”€â”€ Delete{YourEntity}/              # Soft delete â€” sets deleted_at
        â”‚   â”‚       â”œâ”€â”€ Delete{YourEntity}Command.php
        â”‚   â”‚       â””â”€â”€ Delete{YourEntity}Handler.php
        â”‚   â”‚
        â”‚   â”œâ”€â”€ Queries/                             # Read operations
        â”‚   â”‚   â”œâ”€â”€ Get{YourEntity}List/
        â”‚   â”‚   â”‚   â”œâ”€â”€ Get{YourEntity}ListQuery.php # Accepts FilterDTO (page, perPage, search, dateFrom, dateTo, sortBy, sortDir)
        â”‚   â”‚   â”‚   â”œâ”€â”€ Get{YourEntity}ListHandler.php
        â”‚   â”‚   â”‚   â””â”€â”€ ReadModels/
        â”‚   â”‚   â”‚       â””â”€â”€ {YourEntity}ListReadModel.php
        â”‚   â”‚   â””â”€â”€ Get{YourEntity}/
        â”‚   â”‚       â”œâ”€â”€ Get{YourEntity}Query.php
        â”‚   â”‚       â”œâ”€â”€ Get{YourEntity}Handler.php
        â”‚   â”‚       â””â”€â”€ ReadModels/
        â”‚   â”‚           â””â”€â”€ {YourEntity}DetailReadModel.php
        â”‚   â”‚
        â”‚   â”œâ”€â”€ DTOs/
        â”‚   â”‚   â”œâ”€â”€ {YourEntity}FilterDTO.php        # spatie/laravel-data â€” dateFrom, dateTo, search, status, sortBy, sortDir
        â”‚   â”‚   â”œâ”€â”€ Create{YourEntity}DTO.php        # spatie/laravel-data
        â”‚   â”‚   â””â”€â”€ Update{YourEntity}DTO.php        # spatie/laravel-data
        â”‚   â”‚
        â”‚   â”œâ”€â”€ IntegrationEvents/
        â”‚   â”‚   â””â”€â”€ {YourEntity}CreatedIntegration.php
        â”‚   â”‚
        â”‚   â””â”€â”€ EventHandlers/
        â”‚       â””â”€â”€ On{YourEntity}Created.php
        â”‚
        â””â”€â”€ Infrastructure/                          # ğŸ”Œ LAYER 3: Adapters
            â”‚
            â”œâ”€â”€ Adapters/
            â”‚   â”œâ”€â”€ Http/
            â”‚   â”‚   â”œâ”€â”€ Controllers/
            â”‚   â”‚   â”‚   â”œâ”€â”€ Api/
            â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ {YourEntity}Controller.php        # index, show, store, update, destroy
            â”‚   â”‚   â”‚   â”‚   â””â”€â”€ {YourEntity}ExportController.php  # ğŸ”¥ GET /export?format=excel|pdf + FilterDTO
            â”‚   â”‚   â”‚   â””â”€â”€ Web/
            â”‚   â”‚   â”‚       â””â”€â”€ {YourEntity}PageController.php    # Inertia responses
            â”‚   â”‚   â”‚
            â”‚   â”‚   â”œâ”€â”€ Requests/
            â”‚   â”‚   â”‚   â”œâ”€â”€ {YourEntity}FilterRequest.php  # Validates: page, perPage, search, dateFromâ‰¤dateTo, status
            â”‚   â”‚   â”‚   â”œâ”€â”€ Create{YourEntity}Request.php
            â”‚   â”‚   â”‚   â””â”€â”€ Update{YourEntity}Request.php
            â”‚   â”‚   â”‚
            â”‚   â”‚   â”œâ”€â”€ Resources/
            â”‚   â”‚   â”‚   â”œâ”€â”€ {YourEntity}Resource.php
            â”‚   â”‚   â”‚   â””â”€â”€ {YourEntity}Collection.php
            â”‚   â”‚   â”‚
            â”‚   â”‚   â””â”€â”€ Export/                          # ğŸ”¥ Per-context export classes
            â”‚   â”‚       â”œâ”€â”€ {YourEntity}ExcelExport.php  # implements FromQuery + WithHeadings + WithMapping + ShouldAutoSize
            â”‚   â”‚       â””â”€â”€ {YourEntity}PdfExport.php    # Uses Core PdfAdapter â€” cursor() + Blade template
            â”‚   â”‚
            â”‚   â”œâ”€â”€ WebSocket/                           # ğŸ”¥ Real-time updates via Reverb (if needed)
            â”‚   â”‚   â”œâ”€â”€ Channels/
            â”‚   â”‚   â”‚   â””â”€â”€ {YourEntity}Channel.php
            â”‚   â”‚   â””â”€â”€ Events/
            â”‚   â”‚       â””â”€â”€ {YourEntity}UpdatedBroadcast.php
            â”‚   â”‚
            â”‚   â””â”€â”€ CLI/
            â”‚       â””â”€â”€ Commands/
            â”‚           â””â”€â”€ Sync{YourEntity}DataCommand.php
            â”‚
            â”œâ”€â”€ Persistence/
            â”‚   â”œâ”€â”€ Eloquent/
            â”‚   â”‚   â”œâ”€â”€ Models/
            â”‚   â”‚   â”‚   â””â”€â”€ {YourEntity}EloquentModel.php  # @internal â€” Infrastructure only. Use {YourEntity}RepositoryPort.
            â”‚   â”‚   â”‚                                       #   SoftDeletes, timestamps, scopeInDateRange()
            â”‚   â”‚   â”œâ”€â”€ Migrations/
            â”‚   â”‚   â”‚   â””â”€â”€ 2026_xx_create_{your_entities}_table.php  # id, ...fields, created_at, updated_at, deleted_at
            â”‚   â”‚   â”œâ”€â”€ Seeders/
            â”‚   â”‚   â”‚   â””â”€â”€ {YourEntity}Seeder.php
            â”‚   â”‚   â””â”€â”€ Factories/
            â”‚   â”‚       â””â”€â”€ {YourEntity}Factory.php         # For PEST tests
            â”‚   â”‚
            â”‚   â”œâ”€â”€ Repositories/
            â”‚   â”‚   â””â”€â”€ Eloquent{YourEntity}Repository.php  # Implements {YourEntity}RepositoryPort
            â”‚   â”‚
            â”‚   â””â”€â”€ Mappers/
            â”‚       â””â”€â”€ {YourEntity}Mapper.php              # Eloquent â†” Domain Entity
            â”‚
            â”œâ”€â”€ Queue/
            â”‚   â””â”€â”€ Jobs/
            â”‚       â””â”€â”€ Export{YourEntity}QueuedJob.php     # For large exports (>50MB) â€” ShouldQueue
            â”‚
            â”œâ”€â”€ Resources/
            â”‚   â””â”€â”€ views/
            â”‚       â””â”€â”€ pdf/
            â”‚           â””â”€â”€ {your_context}/
            â”‚               â””â”€â”€ {your_entity}-export.blade.php  # PDF Template: inline CSS, base64 logo, filter summary
            â”‚
            â””â”€â”€ Routes/
                â”œâ”€â”€ api.php      # GET /api/{your-context}/{your-entities} (index, show, store, update, destroy)
                â”‚               # GET /api/{your-context}/{your-entities}/export?format=excel|pdf
                â”œâ”€â”€ web.php      # Inertia routes
                â””â”€â”€ channels.php # Reverb channels

---

ğŸ”¥ Key Implemented Changes:

Repositories â†’ Ports in Domain
Infrastructure/Adapters/ groups HTTP, CLI, WebSocket
Infrastructure/Queue/ separated with Jobs + Handlers
WebSocket/ with Reverb in each context that needs it
Core/Shared/Infrastructure/Broadcasting/ for global Reverb configuration
CLI/Commands/Maintenance/ for optimization commands
Health checks for Reverb in Observability

ğŸ”¥ Enterprise 2026 Corrections (Architectural Audit):

1.  Anti-Corruption Layer (ACL) between Bounded Contexts â€” avoids direct coupling
2.  IntegrationEvents/ in each context â€” async communication between contexts
3.  Contracts/ (Published Language) â€” public API each context exposes
4.  Domain Policies/ â€” authorization rules in the domain (not just middleware)
5.  Domain Subscribers/ â€” synchronous reactions within the same transaction
6.  Enums/ with PHP 8.1+ â€” replaces magic strings with type-safe values
7.  ReadModels moved to Application/Queries/ â€” pure CQRS
8.  Additional exceptions: ConcurrencyException, InvariantViolationException, IntegrationException
9.  Audit/ cross-cutting for spatie/laravel-activitylog
10. Export/ cross-cutting for maatwebsite/excel + barryvdh/laravel-dompdf â€” ExcelAdapter + PdfAdapter + PdfTemplateRenderer in Core/Shared
11. SpatieMediaLibraryAdapter for advanced media management
12. ResendAdapter + ReactEmailTemplateRenderer for transactional emails
13. OpenTelemetry SDK 1.x as the 2026 standard (CNCF Graduated) â€” OTLP/gRPC as single protocol; Jaeger/Zipkin receive via OTLP without custom exporters
14. HealthCheckController + HealthCheckAggregator + ExternalServiceHealthCheck â€” complete /health endpoint
15. UnitOfWork + TransactionalCommandBus + RollbackStrategy â€” enterprise DB transactions with rollback
16. Complete Authorization Layer: Gates/, Guards/ (Sanctum, Session, OTP), LaravelPolicies/ + AuthorizationService
17. Refactored Logging: Monolog as central bus with Handlers/ (OpenTelemetryMonologHandler, StructuredJsonHandler) + Processors/ (TraceContextProcessor, CorrelationIdProcessor, RequestContextProcessor) â€” trace_id/span_id automatically injected in all logs
18. InstrumentationProvider for OTEL auto-instrumentation: SQL queries, HTTP client, Redis â€” no manual code
19. CircuitBreakerMetricsExporter â†’ Prometheus: open/closed/half-open state visible in dashboards
20. @internal on all Eloquent Models â€” enforced via PHPStan level 8 (see phpstan.neon below)
21. Architecture tests via PHPArkitect â€” layer boundaries enforced in CI (see tests/Architecture/)

ğŸ“ Context Reference â€” Usage Guide:

Auth/ â†’ Complete authentication: OTP, sessions, permissions, guards, tokens, OAuth + SetupPassword flow: first access via link (registration) and admin reset + SetupToken ValueObject + UserSetupStatus enum (pending_setup | active) + SetupPasswordController: GET+POST /auth/setup-password/{token}
Users/ â†’ Complete enterprise CRUD â€” base template for any new module:
Domain (User Entity + ValueObjects + Enums + Ports + Events + Specifications)
Application (Commands CRUD: Create, Update, Delete, Suspend, Activate, AdminResetPassword)
Application (Queries: ListUsers paginated with filters, GetUser, SearchUsers, ReadModels)
Infrastructure (AdminUserController with 8 routes, Requests, Resources, Persistence, Routes)
NOTE: Super Admin manages users fully. Creation sends a welcome email
with first-access link. AdminResetPassword sends email so user sets their new password.
{YourContext}/ â†’ Generic template at the end of the tree â€” duplicate and replace names for each new module

ğŸ” CRUD Module â€” Role & Permission Naming Convention:

When creating a new CRUD module, ALWAYS follow these naming rules for roles and permissions:

Role Naming:

- Single-word module â†’ `Module` (e.g. `Users`, `Claims`, `Billing`)
- Two-word module â†’ `Module_Module` (e.g. `Water_Quality`, `Work_Orders`, `Service_Areas`)
- Always UPPERCASE first letter per word, joined by underscore

Permission Naming â€” Four base actions per module:

- `VIEW_{MODULE}` â†’ e.g. `VIEW_USERS`, `VIEW_WATER_QUALITY`
- `CREATE_{MODULE}` â†’ e.g. `CREATE_USERS`, `CREATE_WATER_QUALITY`
- `UPDATE_{MODULE}` â†’ e.g. `UPDATE_USERS`, `UPDATE_WATER_QUALITY`
- `DELETE_{MODULE}` â†’ e.g. `DELETE_USERS`, `DELETE_WATER_QUALITY`

Additional permissions may be added per module (e.g. `EXPORT_USERS`, `SUSPEND_USERS`).

Seeder Rule â€” MANDATORY in every PermissionsSeeder:

```php
// ALWAYS call this AFTER batch-creating permissions
app()[\Spatie\Permission\PermissionRegistrar::class]->forgetCachedPermissions();
```

ğŸ§¬ PHP 8.5 Features Applied:

1.  readonly + clone with â†’ ALL Value Objects (Uuid, Email, Money, OtpCode, etc.)
2.  #[NoDiscard] â†’ Domain Services and Specifications (result must never be ignored)
3.  #[Override] on Properties â†’ Entities that extend AggregateRoot ($id typed)
4.  Pipe Operator |> â†’ Pipes (Validation, Transformation, Sanitization), Mappers, Handlers
5.  Closures in Constant Expressions â†’ DTOs with spatie/laravel-data (validation rules)
6.  PHP 8.5 Uri Extension â†’ ValueObjects/Url.php (replaces manual parse_url)
7.  array_first() / array_last() â†’ Replaces reset()/end() throughout the codebase

ğŸ“¦ Composer Packages â†’ Architecture Mapping:

open-telemetry/opentelemetry-php â†’ Core/Shared/Infrastructure/Observability/Tracing/
open-telemetry/exporter-otlp â†’ Core/Shared/Infrastructure/Observability/Tracing/OtlpGrpcExporter.php
monolog/monolog â†’ Core/Shared/Infrastructure/Logging/ (central bus + Processors/Handlers)
intervention/image â†’ Contexts/Users/Infrastructure/Queue/Jobs/ (image processing)
laravel/socialite â†’ Contexts/Auth/Infrastructure/ExternalServices/OAuth/
league/flysystem-aws-s3-v3 â†’ Contexts/Users/Infrastructure/ExternalServices/Storage/
maatwebsite/excel â†’ Core/Shared/Infrastructure/Export/ExcelAdapter.php (+ per-context {Module}ExcelExport.php)
barryvdh/laravel-dompdf â†’ Core/Shared/Infrastructure/Export/PdfAdapter.php (+ per-context {Module}PdfExport.php + resources/views/pdf/{context}/)
ramsey/uuid â†’ Core/Shared/Domain/ValueObjects/Uuid.php
spatie/laravel-cookie-consent â†’ Core/Middleware/CookieConsentMiddleware.php
spatie/laravel-permission â†’ Contexts/Auth/Application/Services/PermissionService.php
spatie/laravel-data â†’ Core/Shared/Application/DTOs/BaseDTO.php (extends Data)
laravel/fortify â†’ Contexts/Auth/Application/Services/AuthenticationService.php
spatie/laravel-one-time-passwords â†’ Contexts/Auth/Domain/Services/OtpGenerator.php
resend/resend-laravel â†’ Contexts/Auth/Infrastructure/ExternalServices/Email/ResendAdapter.php
laravel/reverb â†’ Core/Shared/Infrastructure/Broadcasting/ReverbAdapter.php
laravel/telescope â†’ Core/Shared/Infrastructure/Observability/
laravel/horizon â†’ Core/Shared/Infrastructure/Queue/
spatie/laravel-activitylog â†’ Core/Shared/Infrastructure/Audit/SpatieActivityLogAdapter.php
spatie/laravel-backup â†’ Core/Shared/Infrastructure/
spatie/laravel-medialibrary â†’ Contexts/Users/Infrastructure/ExternalServices/Storage/
laravel/sanctum â†’ Contexts/Auth/ (HasApiTokens on UserEloquentModel)
pestphp/pest â†’ Contexts/\*/Tests/ (Unit, Integration, Feature)
phparkitect/phparkitect â†’ tests/Architecture/ (layer boundary enforcement in CI) ğŸ”¥ NEW
barryvdh/laravel-debugbar â†’ Dev only (APP_DEBUG=true)
barryvdh/laravel-ide-helper â†’ Dev only (\_ide_helper.php)

---

ğŸ›¡ï¸ Architecture Enforcement (NEW â€” Mapper Strategy Completion):

The Mapper pattern (Eloquent â†” Domain) is defined in the folder structure above.
These two additions make it self-enforcing â€” no discipline required from the team.

â‘  @internal on ALL Eloquent Models
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Every \*EloquentModel.php must carry a @internal docblock.
This signals to PHPStan that usage outside the Infrastructure namespace is forbidden.

Example â€” UserEloquentModel.php:

    /**
     * Eloquent persistence model for the Users context.
     *
     * @internal Only for use within Infrastructure\Persistence.
     *           Outside this layer, always inject UserRepositoryPort.
     */
    final class UserEloquentModel extends Model
    {
        use HasRoles, HasApiTokens, SoftDeletes;
        // ...
    }

Apply the same @internal docblock to:

- OtpEloquentModel.php
- SessionEloquentModel.php
- RefreshTokenEloquentModel.php
- UserProfileEloquentModel.php
- UserActivityEloquentModel.php
- {YourEntity}EloquentModel.php â† every new model going forward

â‘¡ PHPStan Configuration (phpstan.neon)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Place this file at the project root. Level 8 activates @internal enforcement.

    # phpstan.neon
    includes:
        - vendor/nunomaduro/larastan/extension.neon

    parameters:
        level: 8
        paths:
            - src
            - tests
        checkInternalClassCaseSensitivity: true
        internalTag: '@internal'

        # Ignore IDE helper generated files
        excludePaths:
            - _ide_helper.php
            - _ide_helper_models.php

        # Treat missing typehints as errors
        reportUnmatchedIgnoredErrors: true
        checkMissingIterableValueType: true
        checkGenericClassInNonGenericObjectType: true

With this config, any class outside Infrastructure\Persistence that imports
a model annotated with @internal will cause a CI failure before merge.

â‘¢ Architecture Tests (tests/Architecture/)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Install: composer require phparkitect/phparkitect --dev

tests/
â””â”€â”€ Architecture/
â”œâ”€â”€ LayerBoundariesTest.php # Domain/Application must not touch Infrastructure/Eloquent
â”œâ”€â”€ NamingConventionsTest.php # Handlers end in Handler, Commands in Command, etc.
â””â”€â”€ DependencyRulesTest.php # Application layer cannot import Infrastructure directly

â”€â”€ LayerBoundariesTest.php â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    <?php

    declare(strict_types=1);

    use Arkitect\Architecture;
    use Arkitect\ClassSet;
    use Arkitect\CLI\Check;
    use Arkitect\Expression\ForClasses\NotDependOnTheseNamespaces;
    use Arkitect\Expression\ForClasses\ResideInOneOfTheseNamespaces;
    use Arkitect\Rules\Rule;

    it('domain layer does not depend on infrastructure', function (): void {
        $classSet = ClassSet::fromDir(__DIR__ . '/../../src');

        $rules = [
            Rule::allClasses()
                ->that(new ResideInOneOfTheseNamespaces('App\Contexts\*\Domain'))
                ->should(new NotDependOnTheseNamespaces(
                    'App\Contexts\*\Infrastructure',
                    'Illuminate\Database\Eloquent',
                    'Illuminate\Http',
                ))
                ->because('Domain must be framework-agnostic and cannot know about Eloquent or HTTP'),

            Rule::allClasses()
                ->that(new ResideInOneOfTheseNamespaces('App\Contexts\*\Application'))
                ->should(new NotDependOnTheseNamespaces(
                    'App\Contexts\*\Infrastructure',
                    'Illuminate\Database\Eloquent',
                ))
                ->because('Application layer orchestrates domain â€” it must not reach into Infrastructure directly'),
        ];

        $violations = Check::assertArchitectureFor($classSet, ...$rules);

        expect($violations)->toBeEmpty();
    });

â”€â”€ NamingConventionsTest.php â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    <?php

    declare(strict_types=1);

    use Arkitect\ClassSet;
    use Arkitect\CLI\Check;
    use Arkitect\Expression\ForClasses\HaveNameMatching;
    use Arkitect\Expression\ForClasses\ResideInOneOfTheseNamespaces;
    use Arkitect\Rules\Rule;

    it('command handlers follow naming convention', function (): void {
        $classSet = ClassSet::fromDir(__DIR__ . '/../../src');

        $rules = [
            Rule::allClasses()
                ->that(new ResideInOneOfTheseNamespaces('App\Contexts\*\Application\Commands'))
                ->andThat(new HaveNameMatching('*Handler'))
                ->should(new HaveNameMatching('*Handler'))
                ->because('Command Handlers must be suffixed with Handler'),

            Rule::allClasses()
                ->that(new ResideInOneOfTheseNamespaces('App\Contexts\*\Application\Queries'))
                ->andThat(new HaveNameMatching('*Handler'))
                ->should(new HaveNameMatching('*Handler'))
                ->because('Query Handlers must be suffixed with Handler'),

            Rule::allClasses()
                ->that(new ResideInOneOfTheseNamespaces('App\Contexts\*\Infrastructure\Persistence\Eloquent\Models'))
                ->should(new HaveNameMatching('*EloquentModel'))
                ->because('Eloquent models must be suffixed with EloquentModel to avoid confusion with Domain Entities'),

            Rule::allClasses()
                ->that(new ResideInOneOfTheseNamespaces('App\Contexts\*\Infrastructure\Persistence\Mappers'))
                ->should(new HaveNameMatching('*Mapper'))
                ->because('Mapper classes must be suffixed with Mapper'),
        ];

        $violations = Check::assertArchitectureFor($classSet, ...$rules);

        expect($violations)->toBeEmpty();
    });

â”€â”€ DependencyRulesTest.php â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    <?php

    declare(strict_types=1);

    use Arkitect\ClassSet;
    use Arkitect\CLI\Check;
    use Arkitect\Expression\ForClasses\NotDependOnTheseNamespaces;
    use Arkitect\Expression\ForClasses\ResideInOneOfTheseNamespaces;
    use Arkitect\Rules\Rule;

    it('contexts do not directly import other contexts domain entities', function (): void {
        $classSet = ClassSet::fromDir(__DIR__ . '/../../src/Contexts');

        // Each context's Domain must only use its own domain or Core/Shared/Domain
        // Cross-context communication must go through Contracts/DTOs or IntegrationEvents
        $rules = [
            Rule::allClasses()
                ->that(new ResideInOneOfTheseNamespaces('App\Contexts\Auth\Domain'))
                ->should(new NotDependOnTheseNamespaces(
                    'App\Contexts\Users\Domain',
                    'App\Contexts\Notifications\Domain',
                ))
                ->because('Bounded Contexts must communicate via Contracts/DTOs or IntegrationEvents, not by importing each other\'s domain'),

            Rule::allClasses()
                ->that(new ResideInOneOfTheseNamespaces('App\Contexts\Users\Domain'))
                ->should(new NotDependOnTheseNamespaces(
                    'App\Contexts\Auth\Domain',
                ))
                ->because('Users domain must remain isolated â€” use Auth Contracts or IntegrationEvents'),
        ];

        $violations = Check::assertArchitectureFor($classSet, ...$rules);

        expect($violations)->toBeEmpty();
    });

â”€â”€ CI Integration (GitHub Actions example) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    # .github/workflows/architecture.yml
    name: Architecture & Static Analysis

    on: [push, pull_request]

    jobs:
      phpstan:
        name: PHPStan Level 8
        runs-on: ubuntu-latest
        steps:
          - uses: actions/checkout@v4
          - uses: shivammathur/setup-php@v2
            with: { php-version: '8.5' }
          - run: composer install --no-interaction
          - run: ./vendor/bin/phpstan analyse --memory-limit=512M

      architecture:
        name: Architecture Tests (PHPArkitect)
        runs-on: ubuntu-latest
        steps:
          - uses: actions/checkout@v4
          - uses: shivammathur/setup-php@v2
            with: { php-version: '8.5' }
          - run: composer install --no-interaction
          - run: ./vendor/bin/pest tests/Architecture/

â”€â”€ Summary: what each layer can and cannot import â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    Layer           | Can import                              | Cannot import
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    Domain          | Core/Shared/Domain, own Value Objects   | Infrastructure, Eloquent, HTTP, Laravel
    Application     | Domain, Core/Shared/Application, DTOs   | Infrastructure, Eloquent
    Infrastructure  | Domain (Ports), Application, Eloquent   | (no restrictions â€” it's the adapter)
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    The Mapper lives in Infrastructure and is the ONLY class allowed to import both
    the Domain Entity and the EloquentModel. No other class should ever do this.

â”€â”€ CRUD Route Pattern â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    Every CRUD module MUST register both Inertia page routes and API routes.
    All module routes live inside the authenticated middleware group in routes/web.php.
    Routes MUST use {uuid} (not {id}) to prevent enumeration attacks.

    Web (Inertia pages) â€” prefix: /{module}

        GET    /{module}                  â†’ PageController@index    â†’ {module}.index
        GET    /{module}/create           â†’ PageController@create   â†’ {module}.create
        GET    /{module}/{uuid}           â†’ PageController@show     â†’ {module}.show
        GET    /{module}/{uuid}/edit      â†’ PageController@edit     â†’ {module}.edit
        DELETE /{module}/{uuid}           â†’ PageController@destroy  â†’ {module}.destroy
        PATCH  /{module}/{uuid}/restore   â†’ PageController@restore  â†’ {module}.restore

    API â€” prefix: /api/{module}

        GET    /api/{module}              â†’ Controller@index    â†’ api.{module}.index
        GET    /api/{module}/{uuid}       â†’ Controller@show     â†’ api.{module}.show
        POST   /api/{module}              â†’ Controller@store    â†’ api.{module}.store
        PUT    /api/{module}/{uuid}       â†’ Controller@update   â†’ api.{module}.update
        DELETE /api/{module}/{uuid}       â†’ Controller@destroy  â†’ api.{module}.destroy
        PATCH  /api/{module}/{uuid}/restore â†’ Controller@restore â†’ api.{module}.restore

    All uuid parameters must use ->whereUuid('uuid').

â”€â”€ Permissions & Roles Convention â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    For every CRUD module, generate 4 permissions + 1 role:

    Permissions:  VIEW_{MODULE}, CREATE_{MODULE}, UPDATE_{MODULE}, DELETE_{MODULE}
    Role:         {ModuleName} (PascalCase)
    Super Admin:  Always receives all module permissions.

    The permissions seeder MUST call:
        app()[\Spatie\Permission\PermissionRegistrar::class]->forgetCachedPermissions();
    BEFORE creating any permissions.
