# PHP 8.5 Â· Laravel 12 Â· Intermediate Enterprise Architecture 2026

# Designed for: 2 Senior Developers

# Philosophy: Hexagonal + DDD principles, without ceremony overhead.

# Same solid foundations â€” less boilerplate, more productivity.

#

# WHAT IS KEPT (non-negotiable):

# âœ… Hexagonal Architecture (Ports & Adapters)

# âœ… Domain Entities + Value Objects (pure, framework-agnostic)

# âœ… Repository Pattern with Ports (interfaces in Domain)

# âœ… Eloquent â†” Domain Mappers (@internal enforced)

# âœ… CQRS (Commands/Queries â€” direct handlers, no formal Bus)

# âœ… DB Transactions (UnitOfWork + TransactionalHandler)

# âœ… Laravel Reverb (WebSockets / real-time)

# âœ… Queue system (Laravel Horizon + RabbitMQ adapter)

# âœ… Storage (S3 + local + SpatieMediaLibrary)

# âœ… Mail (Resend adapter + React Email templates)

# âœ… Circuit Breaker + Retry + Rate Limiter

# âœ… Auth (Sanctum + OTP + OAuth + Guards)

# âœ… PHPStan level 8 + @internal on Eloquent Models

# âœ… OpenTelemetry + Structured Logging (Monolog)

# âœ… Health checks + Prometheus metrics

# âœ… PEST tests (Unit + Integration + Feature)

# âœ… Excel (maatwebsite/excel) + PDF (laravel-dompdf) Exports

#

# WHAT IS SIMPLIFIED (reduces overhead for small teams):

# âŒ No formal CommandBus/QueryBus â€” handlers called directly

# âŒ No IntegrationEvents between contexts â€” use Laravel Events

# âŒ No ACL (Anti-Corruption Layer) between contexts â€” unnecessary with 2 devs

# âŒ No PHPArkitect â€” PHPStan level 8 is sufficient enforcement

# âŒ No separate Contracts/ Published Language per context

# âŒ No Domain Subscribers â€” use standard Laravel Event Listeners

#

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

# HOW TO CREATE A NEW CRUD MODULE

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

# 1. Copy the {YourModule}/ template at the bottom of this file

# 2. Replace {YourModule} with your module name (e.g. Products)

# 3. Replace {YourEntity} with your entity name (e.g. Product)

# 4. Replace {YourId} with your VO id name (e.g. ProductId)

# 5. Create Domain/Entities/{YourEntity}.php â€” pure domain logic, no Eloquent

# 6. Create Domain/ValueObjects/{YourId}.php â€” readonly + clone with

# 7. Create Domain/Ports/{YourEntity}Repository.php â€” interface only

# 8. Create Application/Commands/ handlers â€” write side (no Bus, inject repo directly)

# â†’ MUST dispatch Domain Events (e.g., UserCreated) for write operations

# â†’ MUST implement Domain Event Subscribers to manage Cache::forget invalidations

# 9. Create Application/Queries/ handlers â€” read side (Eloquent OK here)

# â†’ MUST implement Cache::remember with TTL logic

# 10. Create Infrastructure/Persistence/Eloquent/Models/{YourEntity}EloquentModel.php

# â†’ Always add @internal docblock

# â†’ MUST use Spatie\Activitylog\Traits\LogsActivity and implement getActivitylogOptions()

# 11. Create Infrastructure/Persistence/Mappers/{YourEntity}Mapper.php

# â†’ This is the ONLY class allowed to know both Domain Entity and EloquentModel

# 12. Create Infrastructure/Persistence/Repositories/Eloquent{YourEntity}Repository.php

# â†’ Implements {YourEntity}Repository port. Uses Mapper internally.

# 13. Bind Port â†’ Repository in {YourModule}ServiceProvider.php

# 14. Create Infrastructure/Http/Controllers/{YourEntity}Controller.php

# 15. Create Infrastructure/Http/Requests/ + Resources/

# 16. Register routes in Infrastructure/Routes/api.php and Infrastructure/Routes/web.php

# 17. If the module requires user_id by relationship, add it as well as the belongsTo or hasMany from User to that table

# 18. Write PEST tests in Tests/

# 19. Create Infrastructure/Persistence/Export/{YourEntity}ExcelExport.php and PdfExport.php

# 20. Implement {YourEntity}ExportController.php to handle the /export endpoint

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

src/
â”‚
â”œâ”€â”€ Shared/ # ðŸ”§ Cross-cutting â€” shared across all modules
â”‚ â”‚
â”‚ â”œâ”€â”€ Domain/ # Pure shared domain (no framework dependencies)
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Exceptions/ # Base domain exceptions
â”‚ â”‚ â”‚ â”œâ”€â”€ DomainException.php # Base for all domain exceptions
â”‚ â”‚ â”‚ â”œâ”€â”€ EntityNotFoundException.php
â”‚ â”‚ â”‚ â”œâ”€â”€ ValidationException.php
â”‚ â”‚ â”‚ â”œâ”€â”€ UnauthorizedException.php
â”‚ â”‚ â”‚ â”œâ”€â”€ BusinessRuleViolationException.php
â”‚ â”‚ â”‚ â”œâ”€â”€ ConcurrencyException.php # Optimistic locking / race conditions
â”‚ â”‚ â”‚ â”œâ”€â”€ InvariantViolationException.php # Aggregate invariant broken
â”‚ â”‚ â”‚ â””â”€â”€ IntegrationException.php # External service failure
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ ValueObjects/ # Shared Value Objects (readonly + clone with PHP 8.4)
â”‚ â”‚ â”‚ â”œâ”€â”€ Uuid.php # readonly â€” ramsey/uuid
â”‚ â”‚ â”‚ â”œâ”€â”€ Email.php # readonly â€” validated on construction
â”‚ â”‚ â”‚ â”œâ”€â”€ PhoneNumber.php # readonly
â”‚ â”‚ â”‚ â”œâ”€â”€ Money.php # readonly â€” amount + currency
â”‚ â”‚ â”‚ â”œâ”€â”€ DateRange.php # readonly â€” from + to with validation
â”‚ â”‚ â”‚ â”œâ”€â”€ Timestamp.php # readonly â€” immutable datetime wrapper
â”‚ â”‚ â”‚ â””â”€â”€ Url.php # readonly â€” validated URL
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Entities/
â”‚ â”‚ â”‚ â””â”€â”€ AggregateRoot.php # Base aggregate â€” holds domain events list
â”‚ â”‚ â”‚
â”‚ â”‚ â””â”€â”€ Ports/ # Shared infrastructure interfaces (ports)
â”‚ â”‚ â”œâ”€â”€ CachePort.php
â”‚ â”‚ â”œâ”€â”€ QueuePort.php
â”‚ â”‚ â”œâ”€â”€ LoggerPort.php
â”‚ â”‚ â”œâ”€â”€ StoragePort.php
â”‚ â”‚ â”œâ”€â”€ NotificationPort.php
â”‚ â”‚ â””â”€â”€ ExportPort.php # ðŸ”¥ Excel + PDF exports
â”‚ â”‚
â”‚ â”œâ”€â”€ Application/ # Shared application layer
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ DTOs/ # Base DTOs (spatie/laravel-data)
â”‚ â”‚ â”‚ â”œâ”€â”€ BaseDTO.php # extends Data
â”‚ â”‚ â”‚ â”œâ”€â”€ PaginationDTO.php # readonly â€” page, perPage, total
â”‚ â”‚ â”‚ â””â”€â”€ FilterDTO.php # readonly â€” search, dateFrom, dateTo, sortBy, sortDir
â”‚ â”‚ â”‚
â”‚ â”‚ â””â”€â”€ Transactions/ # DB transaction support
â”‚ â”‚ â”œâ”€â”€ TransactionInterface.php
â”‚ â”‚ â””â”€â”€ TransactionalHandler.php # Wraps handler execution in DB::transaction()
â”‚ â”‚ # Usage: extend this in any Command Handler
â”‚ â”‚ # that needs atomic DB operations
â”‚ â”‚
â”‚ â””â”€â”€ Infrastructure/ # Shared infrastructure adapters
â”‚ â”‚
â”‚ â”œâ”€â”€ Cache/
â”‚ â”‚ â”œâ”€â”€ CacheInterface.php
â”‚ â”‚ â”œâ”€â”€ RedisAdapter.php
â”‚ â”‚ â””â”€â”€ InMemoryCacheAdapter.php # For tests
â”‚ â”‚
â”‚ â”œâ”€â”€ Queue/ # Queue system
â”‚ â”‚ â”œâ”€â”€ QueueInterface.php
â”‚ â”‚ â”œâ”€â”€ LaravelQueueAdapter.php # Default â€” uses Laravel + Horizon
â”‚ â”‚ â”œâ”€â”€ RabbitMQAdapter.php # For heavy workloads / decoupled services
â”‚ â”‚ â””â”€â”€ SqsAdapter.php # AWS SQS alternative
â”‚ â”‚
â”‚ â”œâ”€â”€ Broadcasting/ # Real-time â€” Laravel Reverb
â”‚ â”‚ â”œâ”€â”€ BroadcastingInterface.php
â”‚ â”‚ â”œâ”€â”€ ReverbAdapter.php # laravel/reverb â€” primary
â”‚ â”‚ â””â”€â”€ PusherAdapter.php # Fallback
â”‚ â”‚
â”‚ â”œâ”€â”€ Storage/ # File storage
â”‚ â”‚ â”œâ”€â”€ StorageInterface.php
â”‚ â”‚ â”œâ”€â”€ S3StorageAdapter.php # league/flysystem-aws-s3-v3
â”‚ â”‚ â”œâ”€â”€ LocalStorageAdapter.php
â”‚ â”‚ â””â”€â”€ SpatieMediaLibraryAdapter.php # spatie/laravel-medialibrary â€” advanced media
â”‚ â”‚
â”‚ â”œâ”€â”€ Mail/ # Email system
â”‚ â”‚ â”œâ”€â”€ MailInterface.php
â”‚ â”‚ â”œâ”€â”€ ResendAdapter.php # resend/resend-laravel â€” primary
â”‚ â”‚ â”œâ”€â”€ MailgunAdapter.php # Fallback
â”‚ â”‚ â””â”€â”€ ReactEmailTemplateRenderer.php # React Email templates (optional)
â”‚ â”‚
â”‚ â”œâ”€â”€ Export/ # ðŸ”¥ Export system
â”‚ â”‚ â”œâ”€â”€ ExportInterface.php
â”‚ â”‚ â”œâ”€â”€ ExcelAdapter.php # maatwebsite/excel v3
â”‚ â”‚ â”œâ”€â”€ PdfAdapter.php # barryvdh/laravel-dompdf v3
â”‚ â”‚ â””â”€â”€ PdfTemplateRenderer.php # Handles stylized PDF themes with logo
â”‚ â”‚
â”‚ â”œâ”€â”€ Logging/ # Structured logging â€” Monolog as central bus
â”‚ â”‚ â”œâ”€â”€ ApplicationLogger.php
â”‚ â”‚ â”œâ”€â”€ Handlers/
â”‚ â”‚ â”‚ â”œâ”€â”€ OpenTelemetryMonologHandler.php # Monolog â†’ OTEL Collector (OTLP/gRPC)
â”‚ â”‚ â”‚ â””â”€â”€ StructuredJsonHandler.php # Structured stdout for k8s/cloud
â”‚ â”‚ â””â”€â”€ Processors/
â”‚ â”‚ â”œâ”€â”€ TraceContextProcessor.php # Injects trace_id + span_id into every log
â”‚ â”‚ â”œâ”€â”€ CorrelationIdProcessor.php # Injects correlation_id from the request
â”‚ â”‚ â””â”€â”€ RequestContextProcessor.php # Injects user_id, route
â”‚ â”‚
â”‚ â”œâ”€â”€ Observability/ # Metrics, tracing, health
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Tracing/ # OpenTelemetry SDK 1.x (CNCF Graduated)
â”‚ â”‚ â”‚ â”œâ”€â”€ OpenTelemetryAdapter.php # OTLP/gRPC â†’ Collector (Jaeger / Zipkin)
â”‚ â”‚ â”‚ â”œâ”€â”€ InstrumentationProvider.php # Auto-instruments SQL, HTTP client, Redis
â”‚ â”‚ â”‚ â””â”€â”€ SpanEnricher.php
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Metrics/
â”‚ â”‚ â”‚ â”œâ”€â”€ PrometheusAdapter.php # GET /metrics â†’ Prometheus scrape
â”‚ â”‚ â”‚ â””â”€â”€ PrometheusController.php
â”‚ â”‚ â”‚
â”‚ â”‚ â””â”€â”€ HealthCheck/
â”‚ â”‚ â”œâ”€â”€ HealthCheckController.php # GET /health â†’ aggregated status
â”‚ â”‚ â”œâ”€â”€ HealthCheckAggregator.php
â”‚ â”‚ â”œâ”€â”€ DatabaseHealthCheck.php
â”‚ â”‚ â”œâ”€â”€ RedisHealthCheck.php
â”‚ â”‚ â”œâ”€â”€ QueueHealthCheck.php
â”‚ â”‚ â”œâ”€â”€ ReverbHealthCheck.php
â”‚ â”‚ â”œâ”€â”€ StorageHealthCheck.php # S3 / local disk
â”‚ â”‚ â””â”€â”€ ExternalServiceHealthCheck.php # Resend, S3, etc.
â”‚ â”‚
â”‚ â”œâ”€â”€ Resilience/ # Resilience patterns
â”‚ â”‚ â”œâ”€â”€ CircuitBreaker/
â”‚ â”‚ â”‚ â”œâ”€â”€ CircuitBreaker.php
â”‚ â”‚ â”‚ â”œâ”€â”€ CircuitBreakerInterface.php
â”‚ â”‚ â”‚ â”œâ”€â”€ CircuitBreakerState.php # open / closed / half-open
â”‚ â”‚ â”‚ â””â”€â”€ CircuitBreakerMetricsExporter.php # Exports state â†’ Prometheus
â”‚ â”‚ â”œâ”€â”€ RateLimiter/
â”‚ â”‚ â”‚ â”œâ”€â”€ RateLimiter.php
â”‚ â”‚ â”‚ â””â”€â”€ RateLimiterInterface.php
â”‚ â”‚ â””â”€â”€ Retry/
â”‚ â”‚ â”œâ”€â”€ RetryPolicy.php
â”‚ â”‚ â””â”€â”€ ExponentialBackoff.php
â”‚ â”‚
â”‚ â”œâ”€â”€ Persistence/
â”‚ â”‚ â””â”€â”€ Transactions/
â”‚ â”‚ â”œâ”€â”€ DatabaseTransaction.php # Implements TransactionInterface
â”‚ â”‚ â””â”€â”€ UnitOfWork.php # Coordinates persist + flush + rollback
â”‚ â”‚
â”‚ â””â”€â”€ Audit/ # Cross-cutting audit
â”‚ â”œâ”€â”€ AuditInterface.php
â”‚ â”œâ”€â”€ SpatieActivityLogAdapter.php # spatie/laravel-activitylog
â”‚ â””â”€â”€ AuditableInterface.php # Implement on any auditable Eloquent model
â”‚
â”œâ”€â”€ Middleware/ # Global HTTP middleware
â”‚ â”œâ”€â”€ AuthenticationMiddleware.php
â”‚ â”œâ”€â”€ AuthorizationMiddleware.php
â”‚ â”œâ”€â”€ CorrelationIdMiddleware.php
â”‚ â”œâ”€â”€ TraceContextMiddleware.php # Propagates OpenTelemetry trace_id
â”‚ â”œâ”€â”€ RateLimitMiddleware.php
â”‚ â””â”€â”€ SecurityHeadersMiddleware.php
â”‚
â””â”€â”€ Providers/ # Core service providers
â”œâ”€â”€ SharedServiceProvider.php # Binds all shared ports â†’ adapters
â”œâ”€â”€ BroadcastingServiceProvider.php # Reverb config
â””â”€â”€ ObservabilityServiceProvider.php # OTEL + Prometheus + HealthChecks

â””â”€â”€ Modules/ # ðŸ“¦ Feature Modules
â”‚
â”œâ”€â”€ Auth/ # ðŸ” MODULE: Authentication
â”‚ â”‚
â”‚ â”œâ”€â”€ Providers/
â”‚ â”‚ â””â”€â”€ AuthServiceProvider.php # Binds ports â†’ repositories + registers guards
â”‚ â”‚
â”‚ â”œâ”€â”€ Tests/
â”‚ â”‚ â”œâ”€â”€ Unit/
â”‚ â”‚ â”‚ â”œâ”€â”€ Domain/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ OtpValidatorTest.php
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ PasswordHasherTest.php
â”‚ â”‚ â”‚ â””â”€â”€ Application/
â”‚ â”‚ â”‚ â”œâ”€â”€ LoginHandlerTest.php
â”‚ â”‚ â”‚ â””â”€â”€ RegisterUserHandlerTest.php
â”‚ â”‚ â”œâ”€â”€ Integration/
â”‚ â”‚ â”‚ â””â”€â”€ EloquentUserRepositoryTest.php
â”‚ â”‚ â””â”€â”€ Feature/
â”‚ â”‚ â”œâ”€â”€ LoginTest.php
â”‚ â”‚ â”œâ”€â”€ OtpFlowTest.php
â”‚ â”‚ â”œâ”€â”€ SetupPasswordTest.php # First-access link flow
â”‚ â”‚ â””â”€â”€ OAuthTest.php
â”‚ â”‚
â”‚ â”œâ”€â”€ Domain/ # â­ Pure domain â€” zero framework imports
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Entities/
â”‚ â”‚ â”‚ â”œâ”€â”€ User.php # Root aggregate â€” holds identity + status
â”‚ â”‚ â”‚ â”œâ”€â”€ Session.php
â”‚ â”‚ â”‚ â””â”€â”€ RefreshToken.php
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ ValueObjects/
â”‚ â”‚ â”‚ â”œâ”€â”€ UserId.php # readonly
â”‚ â”‚ â”‚ â”œâ”€â”€ UserEmail.php # readonly â€” validated
â”‚ â”‚ â”‚ â”œâ”€â”€ HashedPassword.php # readonly â€” never stores raw password
â”‚ â”‚ â”‚ â”œâ”€â”€ Password.php # readonly â€” raw, for hashing only
â”‚ â”‚ â”‚ â”œâ”€â”€ OtpCode.php # readonly
â”‚ â”‚ â”‚ â”œâ”€â”€ SetupToken.php # readonly â€” first-access / admin reset token
â”‚ â”‚ â”‚ â”œâ”€â”€ SessionId.php # readonly
â”‚ â”‚ â”‚ â””â”€â”€ IpAddress.php # readonly
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Enums/
â”‚ â”‚ â”‚ â”œâ”€â”€ UserStatus.php # active, suspended, pending*setup, banned
â”‚ â”‚ â”‚ â”œâ”€â”€ OtpStatus.php # pending, verified, expired, revoked
â”‚ â”‚ â”‚ â”œâ”€â”€ SessionStatus.php # active, expired, revoked
â”‚ â”‚ â”‚ â””â”€â”€ TokenType.php # access, refresh, api, setup
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Ports/ # Repository interfaces â€” implemented in Infrastructure
â”‚ â”‚ â”‚ â”œâ”€â”€ UserRepositoryPort.php
â”‚ â”‚ â”‚ â”œâ”€â”€ OtpRepositoryPort.php
â”‚ â”‚ â”‚ â”œâ”€â”€ SessionRepositoryPort.php
â”‚ â”‚ â”‚ â””â”€â”€ RefreshTokenRepositoryPort.php
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Services/ # Domain services (stateless, pure logic)
â”‚ â”‚ â”‚ â”œâ”€â”€ OtpGenerator.php # spatie/laravel-one-time-passwords
â”‚ â”‚ â”‚ â”œâ”€â”€ OtpValidator.php
â”‚ â”‚ â”‚ â”œâ”€â”€ PasswordHasher.php
â”‚ â”‚ â”‚ â””â”€â”€ TokenGenerator.php
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Policies/ # Domain authorization rules
â”‚ â”‚ â”‚ â”œâ”€â”€ CanLoginPolicy.php
â”‚ â”‚ â”‚ â”œâ”€â”€ CanResetPasswordPolicy.php
â”‚ â”‚ â”‚ â””â”€â”€ MaxOtpAttemptsPolicy.php
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Events/ # Domain events (dispatched via Laravel Events)
â”‚ â”‚ â”‚ â”œâ”€â”€ UserRegistered.php
â”‚ â”‚ â”‚ â”œâ”€â”€ UserLoggedIn.php
â”‚ â”‚ â”‚ â”œâ”€â”€ UserLoggedOut.php
â”‚ â”‚ â”‚ â”œâ”€â”€ OtpGenerated.php
â”‚ â”‚ â”‚ â”œâ”€â”€ OtpVerified.php
â”‚ â”‚ â”‚ â”œâ”€â”€ PasswordChanged.php
â”‚ â”‚ â”‚ â”œâ”€â”€ FirstTimePasswordSet.php
â”‚ â”‚ â”‚ â””â”€â”€ SessionExpired.php
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Specifications/ # Business rule specifications
â”‚ â”‚ â”‚ â”œâ”€â”€ UserMustHaveUniqueEmail.php
â”‚ â”‚ â”‚ â””â”€â”€ OtpMustNotBeExpired.php
â”‚ â”‚ â”‚
â”‚ â”‚ â””â”€â”€ Exceptions/
â”‚ â”‚ â”œâ”€â”€ InvalidCredentialsException.php
â”‚ â”‚ â”œâ”€â”€ UserNotFoundException.php
â”‚ â”‚ â”œâ”€â”€ UserAlreadyExistsException.php
â”‚ â”‚ â”œâ”€â”€ InvalidOtpException.php
â”‚ â”‚ â”œâ”€â”€ ExpiredOtpException.php
â”‚ â”‚ â”œâ”€â”€ SetupTokenExpiredException.php
â”‚ â”‚ â””â”€â”€ PasswordAlreadySetException.php
â”‚ â”‚
â”‚ â”œâ”€â”€ Application/ # âš™ï¸ Use cases â€” thin orchestrators
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Commands/ # Write operations â€” called directly (no Bus)
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ RegisterUser/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ RegisterUserCommand.php # DTO: name, email, password
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ RegisterUserHandler.php # Creates User entity â†’ saves â†’ dispatches UserRegistered
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ Login/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ LoginCommand.php # DTO: email, password, ip
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ LoginHandler.php # Validates credentials â†’ creates Session â†’ returns tokens
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ LoginWithOtp/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ LoginWithOtpCommand.php
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ LoginWithOtpHandler.php
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ Logout/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ LogoutCommand.php
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ LogoutHandler.php
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ SendOtp/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ SendOtpCommand.php
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ SendOtpHandler.php
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ VerifyOtp/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ VerifyOtpCommand.php
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ VerifyOtpHandler.php
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ ChangePassword/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ ChangePasswordCommand.php
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ ChangePasswordHandler.php # extends TransactionalHandler
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ ResetPassword/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ RequestPasswordResetCommand.php
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ RequestPasswordResetHandler.php
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ ResetPasswordCommand.php
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ ResetPasswordHandler.php
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ SetFirstTimePassword/ # User follows welcome link and sets password
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ SetFirstTimePasswordCommand.php
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ SetFirstTimePasswordHandler.php
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â””â”€â”€ RefreshToken/
â”‚ â”‚ â”‚ â”œâ”€â”€ RefreshTokenCommand.php
â”‚ â”‚ â”‚ â””â”€â”€ RefreshTokenHandler.php
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Queries/ # Read operations â€” Eloquent used directly here
â”‚ â”‚ â”‚ â”œâ”€â”€ GetUser/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ GetUserQuery.php
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ GetUserHandler.php # Returns UserReadModel (not Domain Entity)
â”‚ â”‚ â”‚ â”œâ”€â”€ GetActiveSessions/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ GetActiveSessionsQuery.php
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ GetActiveSessionsHandler.php
â”‚ â”‚ â”‚ â”œâ”€â”€ VerifyToken/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ VerifyTokenQuery.php
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ VerifyTokenHandler.php
â”‚ â”‚ â”‚ â””â”€â”€ ReadModels/ # Read-only projections â€” Eloquent result shaped as DTO
â”‚ â”‚ â”‚ â”œâ”€â”€ UserReadModel.php
â”‚ â”‚ â”‚ â””â”€â”€ SessionReadModel.php
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ EventListeners/ # React to domain events (async, post-commit)
â”‚ â”‚ â”‚ â”œâ”€â”€ SendWelcomeEmailOnRegistered.php
â”‚ â”‚ â”‚ â”œâ”€â”€ SendOtpEmailOnOtpGenerated.php
â”‚ â”‚ â”‚ â””â”€â”€ InvalidateSessionOnPasswordChange.php
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Permissions/ # spatie/laravel-permission definitions
â”‚ â”‚ â”‚ â”œâ”€â”€ RoleDefinitions.php # Declarative list: super_admin, admin, user
â”‚ â”‚ â”‚ â””â”€â”€ PermissionDefinitions.php # Declarative list of all permissions
â”‚ â”‚ â”‚
â”‚ â”‚ â””â”€â”€ Services/ # Application-level orchestration services
â”‚ â”‚ â”œâ”€â”€ AuthenticationService.php # Orchestrates Fortify + Sanctum
â”‚ â”‚ â”œâ”€â”€ PermissionService.php # Wraps spatie/laravel-permission
â”‚ â”‚ â””â”€â”€ AuthorizationService.php
â”‚ â”‚
â”‚ â””â”€â”€ Infrastructure/
â”‚ â”‚
â”‚ â”œâ”€â”€ Http/
â”‚ â”‚ â”œâ”€â”€ Controllers/
â”‚ â”‚ â”‚ â”œâ”€â”€ Api/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ AuthController.php # POST /login, /logout, /refresh
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ OtpController.php # POST /otp/send, /otp/verify
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ PasswordController.php # POST /password/reset, /password/change
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ SetupPasswordController.php # GET+POST /auth/setup-password/{token}
â”‚ â”‚ â”‚ â””â”€â”€ Web/
â”‚ â”‚ â”‚ â””â”€â”€ LoginPageController.php # Inertia â€” GET /login
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Requests/
â”‚ â”‚ â”‚ â”œâ”€â”€ LoginRequest.php
â”‚ â”‚ â”‚ â”œâ”€â”€ RegisterRequest.php
â”‚ â”‚ â”‚ â”œâ”€â”€ SendOtpRequest.php
â”‚ â”‚ â”‚ â”œâ”€â”€ VerifyOtpRequest.php
â”‚ â”‚ â”‚ â”œâ”€â”€ ChangePasswordRequest.php
â”‚ â”‚ â”‚ â”œâ”€â”€ ResetPasswordRequest.php
â”‚ â”‚ â”‚ â””â”€â”€ SetFirstTimePasswordRequest.php
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Resources/
â”‚ â”‚ â”‚ â”œâ”€â”€ UserResource.php
â”‚ â”‚ â”‚ â””â”€â”€ SessionResource.php
â”‚ â”‚ â”‚
â”‚ â”‚ â””â”€â”€ Middleware/
â”‚ â”‚ â”œâ”€â”€ OtpRateLimitMiddleware.php
â”‚ â”‚ â””â”€â”€ CheckSessionValidity.php
â”‚ â”‚
â”‚ â”œâ”€â”€ WebSocket/ # Real-time auth events (Reverb)
â”‚ â”‚ â”œâ”€â”€ Channels/
â”‚ â”‚ â”‚ â”œâ”€â”€ UserChannel.php
â”‚ â”‚ â”‚ â””â”€â”€ SessionChannel.php
â”‚ â”‚ â””â”€â”€ Events/
â”‚ â”‚ â”œâ”€â”€ UserLoggedInBroadcast.php
â”‚ â”‚ â””â”€â”€ SessionExpiredBroadcast.php
â”‚ â”‚
â”‚ â”œâ”€â”€ Persistence/
â”‚ â”‚ â”œâ”€â”€ Eloquent/
â”‚ â”‚ â”‚ â”œâ”€â”€ Models/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ UserEloquentModel.php # @internal â€” only Mappers/Repositories use this
â”‚ â”‚ â”‚ â”‚ â”‚ # HasRoles (spatie), HasApiTokens (sanctum), SoftDeletes
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ OtpEloquentModel.php # @internal
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ SessionEloquentModel.php # @internal
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ RefreshTokenEloquentModel.php # @internal
â”‚ â”‚ â”‚ â”œâ”€â”€ Migrations/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ 2026_01_create_users_table.php
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ 2026_02_create_otp_codes_table.php
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ 2026_03_create_sessions_table.php
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ 2026_04_create_refresh_tokens_table.php
â”‚ â”‚ â”‚ â”œâ”€â”€ Seeders/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ RolesSeeder.php # spatie/laravel-permission
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ PermissionsSeeder.php
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ SuperAdminSeeder.php
â”‚ â”‚ â”‚ â””â”€â”€ Factories/
â”‚ â”‚ â”‚ â”œâ”€â”€ UserFactory.php
â”‚ â”‚ â”‚ â””â”€â”€ OtpFactory.php
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Repositories/
â”‚ â”‚ â”‚ â”œâ”€â”€ EloquentUserRepository.php # Implements UserRepositoryPort â€” uses UserMapper
â”‚ â”‚ â”‚ â”œâ”€â”€ EloquentOtpRepository.php
â”‚ â”‚ â”‚ â”œâ”€â”€ EloquentSessionRepository.php
â”‚ â”‚ â”‚ â””â”€â”€ EloquentRefreshTokenRepository.php
â”‚ â”‚ â”‚
â”‚ â”‚ â””â”€â”€ Mappers/ # Eloquent â†” Domain Entity translation
â”‚ â”‚ â”œâ”€â”€ UserMapper.php # ONLY class that imports both User entity + UserEloquentModel
â”‚ â”‚ â”œâ”€â”€ OtpMapper.php
â”‚ â”‚ â”œâ”€â”€ SessionMapper.php
â”‚ â”‚ â””â”€â”€ RefreshTokenMapper.php
â”‚ â”‚
â”‚ â”œâ”€â”€ Queue/
â”‚ â”‚ â””â”€â”€ Jobs/
â”‚ â”‚ â”œâ”€â”€ SendOtpEmailJob.php
â”‚ â”‚ â”œâ”€â”€ SendOtpSmsJob.php
â”‚ â”‚ â”œâ”€â”€ SendWelcomeSetupEmailJob.php # Welcome email with first-access link
â”‚ â”‚ â”œâ”€â”€ SendPasswordResetEmailJob.php
â”‚ â”‚ â””â”€â”€ SendAdminPasswordResetEmailJob.php
â”‚ â”‚
â”‚ â”œâ”€â”€ ExternalServices/
â”‚ â”‚ â”œâ”€â”€ OAuth/ # laravel/socialite
â”‚ â”‚ â”‚ â”œâ”€â”€ OAuthProviderInterface.php
â”‚ â”‚ â”‚ â”œâ”€â”€ GoogleOAuthAdapter.php
â”‚ â”‚ â”‚ â”œâ”€â”€ GithubOAuthAdapter.php
â”‚ â”‚ â”‚ â””â”€â”€ MicrosoftOAuthAdapter.php
â”‚ â”‚ â”‚
â”‚ â”‚ â””â”€â”€ Authorization/
â”‚ â”‚ â”œâ”€â”€ Gates/
â”‚ â”‚ â”‚ â”œâ”€â”€ ManageUsersGate.php
â”‚ â”‚ â”‚ â””â”€â”€ ViewAuditLogGate.php
â”‚ â”‚ â””â”€â”€ Guards/
â”‚ â”‚ â”œâ”€â”€ SanctumGuard.php
â”‚ â”‚ â”œâ”€â”€ SessionGuard.php
â”‚ â”‚ â””â”€â”€ OtpGuard.php
â”‚ â”‚
â”‚ â””â”€â”€ Routes/
â”‚ â”œâ”€â”€ api.php
â”‚ â”œâ”€â”€ web.php
â”‚ â””â”€â”€ channels.php # Reverb channel definitions
â”‚
â”‚
â”œâ”€â”€ Users/ # ðŸ‘¤ MODULE: User Management (admin CRUD)
â”‚ â”‚
â”‚ â”œâ”€â”€ Providers/
â”‚ â”‚ â””â”€â”€ UsersServiceProvider.php # Binds UserRepositoryPort â†’ EloquentUserRepository
â”‚ â”‚
â”‚ â”œâ”€â”€ Tests/
â”‚ â”‚ â”œâ”€â”€ Unit/
â”‚ â”‚ â”‚ â”œâ”€â”€ Domain/
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ UserStatusManagerTest.php
â”‚ â”‚ â”‚ â””â”€â”€ Application/
â”‚ â”‚ â”‚ â”œâ”€â”€ CreateUserHandlerTest.php
â”‚ â”‚ â”‚ â””â”€â”€ SuspendUserHandlerTest.php
â”‚ â”‚ â”œâ”€â”€ Integration/
â”‚ â”‚ â”‚ â””â”€â”€ EloquentUserRepositoryTest.php
â”‚ â”‚ â””â”€â”€ Feature/
â”‚ â”‚ â”œâ”€â”€ AdminCrudUserTest.php # Full CRUD as Super Admin
â”‚ â”‚ â”œâ”€â”€ SetFirstTimePasswordTest.php # Welcome flow â†’ link â†’ set password
â”‚ â”‚ â””â”€â”€ AdminResetPasswordTest.php # Admin resets â†’ email â†’ user sets new one
â”‚ â”‚
â”‚ â”œâ”€â”€ Domain/
â”‚ â”‚ â”œâ”€â”€ Entities/
â”‚ â”‚ â”‚ â”œâ”€â”€ User.php # Root entity â€” status, profile, suspension logic
â”‚ â”‚ â”‚ â””â”€â”€ UserProfile.php
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ ValueObjects/
â”‚ â”‚ â”‚ â”œâ”€â”€ UserId.php # readonly
â”‚ â”‚ â”‚ â”œâ”€â”€ FullName.php # readonly
â”‚ â”‚ â”‚ â”œâ”€â”€ Avatar.php # readonly
â”‚ â”‚ â”‚ â””â”€â”€ Bio.php # readonly
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Enums/
â”‚ â”‚ â”‚ â””â”€â”€ UserStatus.php # active, suspended, pending_setup, deleted
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Ports/
â”‚ â”‚ â”‚ â”œâ”€â”€ UserRepositoryPort.php
â”‚ â”‚ â”‚ â””â”€â”€ UserProfileRepositoryPort.php
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Services/
â”‚ â”‚ â”‚ â””â”€â”€ UserStatusManager.php # suspend / activate / ban business rules
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Events/
â”‚ â”‚ â”‚ â”œâ”€â”€ UserCreatedByAdmin.php # â†’ triggers WelcomeSetupEmailJob
â”‚ â”‚ â”‚ â”œâ”€â”€ UserSuspended.php
â”‚ â”‚ â”‚ â”œâ”€â”€ UserActivated.php
â”‚ â”‚ â”‚ â”œâ”€â”€ UserDeleted.php
â”‚ â”‚ â”‚ â””â”€â”€ AvatarChanged.php
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Specifications/
â”‚ â”‚ â”‚ â””â”€â”€ UserEmailMustBeUnique.php
â”‚ â”‚ â”‚
â”‚ â”‚ â””â”€â”€ Exceptions/
â”‚ â”‚ â”œâ”€â”€ UserNotFoundException.php
â”‚ â”‚ â”œâ”€â”€ UserAlreadyExistsException.php
â”‚ â”‚ â””â”€â”€ InvalidAvatarException.php
â”‚ â”‚
â”‚ â”œâ”€â”€ Application/
â”‚ â”‚ â”œâ”€â”€ Commands/
â”‚ â”‚ â”‚ â”œâ”€â”€ CreateUser/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ CreateUserCommand.php # name, email, role â€” no password (user sets it via link)
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ CreateUserHandler.php # Creates user status=pending_setup â†’ UserCreatedByAdmin event
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ UpdateUser/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ UpdateUserCommand.php # name, email, role, status
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ UpdateUserHandler.php
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ SuspendUser/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ SuspendUserCommand.php
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ SuspendUserHandler.php
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ ActivateUser/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ ActivateUserCommand.php
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ ActivateUserHandler.php
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ DeleteUser/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ DeleteUserCommand.php # Soft delete
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ DeleteUserHandler.php
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ AdminResetPassword/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ AdminResetPasswordCommand.php
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ AdminResetPasswordHandler.php # Generates SetupToken â†’ sends email
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â””â”€â”€ UpdateProfile/
â”‚ â”‚ â”‚ â”œâ”€â”€ UpdateProfileCommand.php
â”‚ â”‚ â”‚ â””â”€â”€ UpdateProfileHandler.php
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Queries/
â”‚ â”‚ â”‚ â”œâ”€â”€ ListUsers/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ ListUsersQuery.php # filters: status, role, search, dateRange
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ ListUsersHandler.php # Eloquent directly â€” returns paginated ReadModel
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ GetUser/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ GetUserQuery.php
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ GetUserHandler.php
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â””â”€â”€ ReadModels/
â”‚ â”‚ â”‚ â”œâ”€â”€ UserReadModel.php
â”‚ â”‚ â”‚ â”œâ”€â”€ UserListReadModel.php # Compact â€” for admin table
â”‚ â”‚ â”‚ â””â”€â”€ UserProfileReadModel.php
â”‚ â”‚ â”‚
â”‚ â”‚ â””â”€â”€ EventListeners/
â”‚ â”‚ â”œâ”€â”€ SendWelcomeEmailOnUserCreated.php # Listens to UserCreatedByAdmin
â”‚ â”‚ â””â”€â”€ InvalidateUserCacheOnUpdate.php
â”‚ â”‚
â”‚ â””â”€â”€ Infrastructure/
â”‚ â”œâ”€â”€ Http/
â”‚ â”‚ â”œâ”€â”€ Controllers/
â”‚ â”‚ â”‚ â”œâ”€â”€ Api/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ AdminUserController.php # Full CRUD â€” Super Admin only
â”‚ â”‚ â”‚ â”‚ â”‚ # GET /api/admin/users
â”‚ â”‚ â”‚ â”‚ â”‚ # POST /api/admin/users
â”‚ â”‚ â”‚ â”‚ â”‚ # GET /api/admin/users/{id}
â”‚ â”‚ â”‚ â”‚ â”‚ # PUT /api/admin/users/{id}
â”‚ â”‚ â”‚ â”‚ â”‚ # DELETE /api/admin/users/{id}
â”‚ â”‚ â”‚ â”‚ â”‚ # POST /api/admin/users/{id}/suspend
â”‚ â”‚ â”‚ â”‚ â”‚ # POST /api/admin/users/{id}/activate
â”‚ â”‚ â”‚ â”‚ â”‚ # POST /api/admin/users/{id}/reset-password
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ UserProfileController.php # Authenticated user's own profile
â”‚ â”‚ â”‚ â””â”€â”€ Web/
â”‚ â”‚ â”‚ â””â”€â”€ ProfilePageController.php # Inertia
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Requests/
â”‚ â”‚ â”‚ â”œâ”€â”€ CreateUserRequest.php
â”‚ â”‚ â”‚ â”œâ”€â”€ UpdateUserRequest.php
â”‚ â”‚ â”‚ â””â”€â”€ UpdateProfileRequest.php
â”‚ â”‚ â”‚
â”‚ â”‚ â””â”€â”€ Resources/
â”‚ â”‚ â”œâ”€â”€ UserResource.php
â”‚ â”‚ â”œâ”€â”€ UserListResource.php
â”‚ â”‚ â”œâ”€â”€ UserProfileResource.php
â”‚ â”‚ â””â”€â”€ UserCollection.php
â”‚ â”‚
â”‚ â”œâ”€â”€ WebSocket/
â”‚ â”‚ â”œâ”€â”€ Channels/
â”‚ â”‚ â”‚ â””â”€â”€ UserPresenceChannel.php
â”‚ â”‚ â””â”€â”€ Events/
â”‚ â”‚ â””â”€â”€ UserStatusChangedBroadcast.php
â”‚ â”‚
â”‚ â”œâ”€â”€ Persistence/
â”‚ â”‚ â”œâ”€â”€ Eloquent/
â”‚ â”‚ â”‚ â”œâ”€â”€ Models/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ UserEloquentModel.php # @internal â€” Infrastructure only. Use UserRepositoryPort.
â”‚ â”‚ â”‚ â”‚ â”‚ # HasRoles, HasApiTokens, SoftDeletes, setup_status
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ UserProfileEloquentModel.php # @internal
â”‚ â”‚ â”‚ â”œâ”€â”€ Migrations/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ 2026_01_create_users_table.php # +setup_status, +setup_token_expires_at
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ 2026_02_create_user_profiles_table.php
â”‚ â”‚ â”‚ â”œâ”€â”€ Seeders/
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ SuperAdminSeeder.php
â”‚ â”‚ â”‚ â””â”€â”€ Factories/
â”‚ â”‚ â”‚ â””â”€â”€ UserFactory.php
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Repositories/
â”‚ â”‚ â”‚ â”œâ”€â”€ EloquentUserRepository.php # Implements UserRepositoryPort
â”‚ â”‚ â”‚ â””â”€â”€ EloquentUserProfileRepository.php
â”‚ â”‚ â”‚
â”‚ â”‚ â””â”€â”€ Mappers/
â”‚ â”‚ â”œâ”€â”€ UserMapper.php
â”‚ â”‚ â””â”€â”€ UserProfileMapper.php
â”‚ â”‚
â”‚ â”œâ”€â”€ Queue/
â”‚ â”‚ â””â”€â”€ Jobs/
â”‚ â”‚ â”œâ”€â”€ ProcessAvatarJob.php # intervention/image
â”‚ â”‚ â””â”€â”€ ResendSetupEmailJob.php
â”‚ â”‚
â”‚ â”œâ”€â”€ Storage/
â”‚ â”‚ â””â”€â”€ UserAvatarStorage.php # Wraps SpatieMediaLibraryAdapter for user avatars
â”‚ â”‚
â”‚ â””â”€â”€ Routes/
â”‚ â”œâ”€â”€ api.php # /admin/users/\* â€” role:super-admin middleware
â”‚ â”œâ”€â”€ web.php
â”‚ â””â”€â”€ channels.php
â”‚
â”‚
â”œâ”€â”€ Notifications/ # ðŸ“§ MODULE: Notifications
â”‚ â”‚
â”‚ â”œâ”€â”€ Providers/
â”‚ â”‚ â””â”€â”€ NotificationsServiceProvider.php
â”‚ â”‚
â”‚ â”œâ”€â”€ Tests/
â”‚ â”‚ â”œâ”€â”€ Unit/
â”‚ â”‚ â”‚ â””â”€â”€ Application/
â”‚ â”‚ â”‚ â””â”€â”€ SendNotificationHandlerTest.php
â”‚ â”‚ â”œâ”€â”€ Integration/
â”‚ â”‚ â”‚ â””â”€â”€ EloquentNotificationRepositoryTest.php
â”‚ â”‚ â””â”€â”€ Feature/
â”‚ â”‚ â”œâ”€â”€ SendNotificationTest.php
â”‚ â”‚ â””â”€â”€ RealtimeNotificationTest.php # WebSocket delivery
â”‚ â”‚
â”‚ â”œâ”€â”€ Domain/
â”‚ â”‚ â”œâ”€â”€ Entities/
â”‚ â”‚ â”‚ â””â”€â”€ Notification.php
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ ValueObjects/
â”‚ â”‚ â”‚ â”œâ”€â”€ NotificationId.php # readonly
â”‚ â”‚ â”‚ â””â”€â”€ NotificationContent.php # readonly â€” title + body
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Enums/
â”‚ â”‚ â”‚ â”œâ”€â”€ NotificationStatus.php # pending, sent, read, failed
â”‚ â”‚ â”‚ â””â”€â”€ DeliveryChannel.php # email, sms, push, in_app, websocket
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Ports/
â”‚ â”‚ â”‚ â””â”€â”€ NotificationRepositoryPort.php
â”‚ â”‚ â”‚
â”‚ â”‚ â””â”€â”€ Exceptions/
â”‚ â”‚ â””â”€â”€ NotificationDeliveryException.php
â”‚ â”‚
â”‚ â”œâ”€â”€ Application/
â”‚ â”‚ â”œâ”€â”€ Commands/
â”‚ â”‚ â”‚ â””â”€â”€ SendNotification/
â”‚ â”‚ â”‚ â”œâ”€â”€ SendNotificationCommand.php
â”‚ â”‚ â”‚ â””â”€â”€ SendNotificationHandler.php
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Queries/
â”‚ â”‚ â”‚ â””â”€â”€ GetUserNotifications/
â”‚ â”‚ â”‚ â”œâ”€â”€ GetUserNotificationsQuery.php
â”‚ â”‚ â”‚ â”œâ”€â”€ GetUserNotificationsHandler.php
â”‚ â”‚ â”‚ â””â”€â”€ ReadModels/
â”‚ â”‚ â”‚ â””â”€â”€ NotificationReadModel.php
â”‚ â”‚ â”‚
â”‚ â”‚ â””â”€â”€ EventListeners/
â”‚ â”‚ â””â”€â”€ BroadcastNotificationOnSent.php
â”‚ â”‚
â”‚ â””â”€â”€ Infrastructure/
â”‚ â”œâ”€â”€ Http/
â”‚ â”‚ â”œâ”€â”€ Controllers/
â”‚ â”‚ â”‚ â””â”€â”€ Api/
â”‚ â”‚ â”‚ â””â”€â”€ NotificationController.php
â”‚ â”‚ â””â”€â”€ Resources/
â”‚ â”‚ â”œâ”€â”€ NotificationResource.php
â”‚ â”‚ â””â”€â”€ NotificationCollection.php
â”‚ â”‚
â”‚ â”œâ”€â”€ WebSocket/ # Real-time notifications (Reverb)
â”‚ â”‚ â”œâ”€â”€ Channels/
â”‚ â”‚ â”‚ â””â”€â”€ UserNotificationChannel.php
â”‚ â”‚ â””â”€â”€ Events/
â”‚ â”‚ â”œâ”€â”€ NotificationSentBroadcast.php
â”‚ â”‚ â””â”€â”€ NotificationReadBroadcast.php
â”‚ â”‚
â”‚ â”œâ”€â”€ Persistence/
â”‚ â”‚ â”œâ”€â”€ Eloquent/
â”‚ â”‚ â”‚ â”œâ”€â”€ Models/
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ NotificationEloquentModel.php # @internal
â”‚ â”‚ â”‚ â”œâ”€â”€ Migrations/
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ 2026_01_create_notifications_table.php
â”‚ â”‚ â”‚ â””â”€â”€ Factories/
â”‚ â”‚ â”‚ â””â”€â”€ NotificationFactory.php
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Repositories/
â”‚ â”‚ â”‚ â””â”€â”€ EloquentNotificationRepository.php
â”‚ â”‚ â”‚
â”‚ â”‚ â””â”€â”€ Mappers/
â”‚ â”‚ â””â”€â”€ NotificationMapper.php
â”‚ â”‚
â”‚ â”œâ”€â”€ Queue/
â”‚ â”‚ â””â”€â”€ Jobs/
â”‚ â”‚ â”œâ”€â”€ SendEmailNotificationJob.php
â”‚ â”‚ â”œâ”€â”€ SendSmsNotificationJob.php
â”‚ â”‚ â””â”€â”€ SendPushNotificationJob.php
â”‚ â”‚
â”‚ â”œâ”€â”€ ExternalServices/
â”‚ â”‚ â”œâ”€â”€ Push/
â”‚ â”‚ â”‚ â”œâ”€â”€ FirebaseAdapter.php
â”‚ â”‚ â”‚ â””â”€â”€ OneSignalAdapter.php
â”‚ â”‚ â””â”€â”€ Sms/
â”‚ â”‚ â”œâ”€â”€ SmsGatewayInterface.php
â”‚ â”‚ â”œâ”€â”€ TwilioAdapter.php
â”‚ â”‚ â””â”€â”€ VonageAdapter.php
â”‚ â”‚
â”‚ â””â”€â”€ Routes/
â”‚ â”œâ”€â”€ api.php
â”‚ â””â”€â”€ channels.php
â”‚
â”‚
â”œâ”€â”€ AI/ # ðŸ¤– MODULE: Artificial Intelligence
â”‚ â”‚
â”‚ â”œâ”€â”€ Providers/
â”‚ â”‚ â””â”€â”€ AIServiceProvider.php
â”‚ â”‚
â”‚ â”œâ”€â”€ Tests/
â”‚ â”‚ â”œâ”€â”€ Unit/
â”‚ â”‚ â”‚ â””â”€â”€ Application/
â”‚ â”‚ â”‚ â””â”€â”€ GenerateContentHandlerTest.php
â”‚ â”‚ â”œâ”€â”€ Integration/
â”‚ â”‚ â”‚ â””â”€â”€ PrismLLMAdapterTest.php
â”‚ â”‚ â””â”€â”€ Feature/
â”‚ â”‚ â”œâ”€â”€ GenerateContentTest.php
â”‚ â”‚ â””â”€â”€ AIStreamingTest.php # WebSocket streaming
â”‚ â”‚
â”‚ â”œâ”€â”€ Domain/
â”‚ â”‚ â”œâ”€â”€ Ports/
â”‚ â”‚ â”‚ â””â”€â”€ LLMProviderPort.php # Abstract interface â€” any LLM
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ ValueObjects/
â”‚ â”‚ â”‚ â”œâ”€â”€ Prompt.php # readonly
â”‚ â”‚ â”‚ â”œâ”€â”€ AIResponse.php # readonly
â”‚ â”‚ â”‚ â””â”€â”€ StructuredSchema.php # readonly
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Enums/
â”‚ â”‚ â”‚ â”œâ”€â”€ AIProvider.php # openai, anthropic, gemini, ollama
â”‚ â”‚ â”‚ â””â”€â”€ ResponseFormat.php # text, structured, stream
â”‚ â”‚ â”‚
â”‚ â”‚ â””â”€â”€ Services/
â”‚ â”‚ â”œâ”€â”€ ContentGenerator.php
â”‚ â”‚ â””â”€â”€ TextAnalyzer.php
â”‚ â”‚
â”‚ â”œâ”€â”€ Application/
â”‚ â”‚ â”œâ”€â”€ Commands/
â”‚ â”‚ â”‚ â”œâ”€â”€ GenerateContent/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ GenerateContentCommand.php
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ GenerateContentHandler.php
â”‚ â”‚ â”‚ â””â”€â”€ AnalyzeText/
â”‚ â”‚ â”‚ â”œâ”€â”€ AnalyzeTextCommand.php
â”‚ â”‚ â”‚ â””â”€â”€ AnalyzeTextHandler.php
â”‚ â”‚ â”‚
â”‚ â”‚ â””â”€â”€ Queries/
â”‚ â”‚ â””â”€â”€ GetAIModels/
â”‚ â”‚ â”œâ”€â”€ GetAIModelsQuery.php
â”‚ â”‚ â””â”€â”€ GetAIModelsHandler.php
â”‚ â”‚
â”‚ â””â”€â”€ Infrastructure/
â”‚ â”œâ”€â”€ Http/
â”‚ â”‚ â””â”€â”€ Controllers/
â”‚ â”‚ â””â”€â”€ Api/
â”‚ â”‚ â””â”€â”€ AIController.php
â”‚ â”‚
â”‚ â”œâ”€â”€ WebSocket/ # Real-time AI streaming (Reverb)
â”‚ â”‚ â””â”€â”€ Events/
â”‚ â”‚ â””â”€â”€ AIResponseStreamBroadcast.php
â”‚ â”‚
â”‚ â”œâ”€â”€ Queue/
â”‚ â”‚ â””â”€â”€ Jobs/
â”‚ â”‚ â”œâ”€â”€ GenerateContentAsyncJob.php # Long-running AI generation
â”‚ â”‚ â””â”€â”€ AnalyzeTextAsyncJob.php
â”‚ â”‚
â”‚ â”œâ”€â”€ ExternalServices/
â”‚ â”‚ â”œâ”€â”€ Prism/ # prism-php/prism â€” primary LLM gateway
â”‚ â”‚ â”‚ â”œâ”€â”€ PrismLLMAdapter.php # Text, chat, conversation
â”‚ â”‚ â”‚ â””â”€â”€ PrismStructuredAdapter.php # Structured output with DTOs
â”‚ â”‚ â”‚
â”‚ â”‚ â””â”€â”€ FastAPI/ # Optional: Python microservice for heavy ML
â”‚ â”‚ â”œâ”€â”€ FastAPIClientInterface.php
â”‚ â”‚ â”œâ”€â”€ FastAPIAdapter.php # Guzzle/Http â€” uses CircuitBreaker
â”‚ â”‚ â”œâ”€â”€ FastAPIHealthCheck.php
â”‚ â”‚ â””â”€â”€ Config/
â”‚ â”‚ â””â”€â”€ fastapi.php # base_url, timeout, retry, api_key
â”‚ â”‚
â”‚ â””â”€â”€ Routes/
â”‚ â”œâ”€â”€ api.php
â”‚ â””â”€â”€ channels.php
â”‚
â”‚
â””â”€â”€ {YourModule}/ # â­ TEMPLATE â€” Copy this for every new CRUD module
â”‚
â”‚ # â”€â”€ HOW TO USE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚ # See step-by-step instructions at the top of this file.
â”‚ # Replace: {YourModule} â†’ e.g. Products
â”‚ # {YourEntity} â†’ e.g. Product
â”‚ # {YourId} â†’ e.g. ProductId
â”‚ # Reference: Users module above is the complete example.
â”‚ # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚
â”œâ”€â”€ Providers/
â”‚ â””â”€â”€ {YourModule}ServiceProvider.php # âš ï¸ REQUIRED: bind {YourEntity}RepositoryPort
â”‚ # â†’ Eloquent{YourEntity}Repository in register()
â”‚
â”œâ”€â”€ Tests/
â”‚ â”œâ”€â”€ Unit/
â”‚ â”‚ â”œâ”€â”€ Domain/
â”‚ â”‚ â”‚ â””â”€â”€ {YourEntity}Test.php # Test domain invariants and business rules
â”‚ â”‚ â””â”€â”€ Application/
â”‚ â”‚ â”œâ”€â”€ Create{YourEntity}HandlerTest.php
â”‚ â”‚ â””â”€â”€ Update{YourEntity}HandlerTest.php
â”‚ â”œâ”€â”€ Integration/
â”‚ â”‚ â””â”€â”€ Eloquent{YourEntity}RepositoryTest.php # Tests DB round-trip via Mapper
â”‚ â””â”€â”€ Feature/
â”‚ â”œâ”€â”€ {YourEntity}CrudTest.php # Full HTTP CRUD as authenticated user
â”‚ â””â”€â”€ {YourEntity}ExportTest.php # Excel + PDF export (if applicable)
â”‚
â”œâ”€â”€ Domain/ # â­ LAYER 1 â€” Pure, no framework imports
â”‚ â”‚
â”‚ â”œâ”€â”€ Entities/
â”‚ â”‚ â””â”€â”€ {YourEntity}.php # extends AggregateRoot
â”‚ â”‚ # Holds business logic + domain events
â”‚ â”‚ # NEVER import Eloquent here
â”‚ â”‚
â”‚ â”œâ”€â”€ ValueObjects/
â”‚ â”‚ â”œâ”€â”€ {YourId}.php # readonly â€” ramsey/uuid
â”‚ â”‚ â””â”€â”€ ... # Other domain VOs as needed
â”‚ â”‚
â”‚ â”œâ”€â”€ Enums/
â”‚ â”‚ â””â”€â”€ {YourEntity}Status.php # active, inactive, archived, deleted
â”‚ â”‚
â”‚ â”œâ”€â”€ Ports/ # Repository interface â€” no implementation here
â”‚ â”‚ â””â”€â”€ {YourEntity}RepositoryPort.php # find(), save(), delete(), list()
â”‚ â”‚
â”‚ â”œâ”€â”€ Services/ # Domain services â€” stateless business logic
â”‚ â”‚ â””â”€â”€ {YourEntity}DomainService.php # Only if logic spans multiple entities
â”‚ â”‚
â”‚ â”œâ”€â”€ Events/ # Dispatched via Laravel Events
â”‚ â”‚ â”œâ”€â”€ {YourEntity}Created.php
â”‚ â”‚ â”œâ”€â”€ {YourEntity}Updated.php
â”‚ â”‚ â””â”€â”€ {YourEntity}Deleted.php
â”‚ â”‚
â”‚ â”œâ”€â”€ Specifications/ # Reusable business rule checks
â”‚ â”‚ â””â”€â”€ {YourEntity}MustBeUnique.php
â”‚ â”‚
â”‚ â””â”€â”€ Exceptions/
â”‚ â”œâ”€â”€ {YourEntity}NotFoundException.php
â”‚ â””â”€â”€ {YourEntity}AlreadyExistsException.php
â”‚
â”œâ”€â”€ Application/ # âš™ï¸ LAYER 2 â€” Use cases (thin orchestrators)
â”‚ â”‚
â”‚ â”œâ”€â”€ Commands/ # Write operations
â”‚ â”‚ â”‚ # Pattern: inject Repository port directly
â”‚ â”‚ â”‚ # Extend TransactionalHandler if DB atomicity needed
â”‚ â”‚ â”œâ”€â”€ Create{YourEntity}/
â”‚ â”‚ â”‚ â”œâ”€â”€ Create{YourEntity}Command.php
â”‚ â”‚ â”‚ â””â”€â”€ Create{YourEntity}Handler.php
â”‚ â”‚ â”œâ”€â”€ Update{YourEntity}/
â”‚ â”‚ â”‚ â”œâ”€â”€ Update{YourEntity}Command.php
â”‚ â”‚ â”‚ â””â”€â”€ Update{YourEntity}Handler.php
â”‚ â”‚ â””â”€â”€ Delete{YourEntity}/
â”‚ â”‚ â”œâ”€â”€ Delete{YourEntity}Command.php
â”‚ â”‚ â””â”€â”€ Delete{YourEntity}Handler.php # Soft delete â€” sets deleted_at
â”‚ â”‚
â”‚ â”œâ”€â”€ Queries/ # Read operations
â”‚ â”‚ â”‚ # Pattern: Eloquent used directly here (no Mapper needed)
â”‚ â”‚ â”‚ # Return ReadModels, not Domain Entities
â”‚ â”‚ â”œâ”€â”€ Get{YourEntity}List/
â”‚ â”‚ â”‚ â”œâ”€â”€ Get{YourEntity}ListQuery.php # Accepts FilterDTO
â”‚ â”‚ â”‚ â”œâ”€â”€ Get{YourEntity}ListHandler.php
â”‚ â”‚ â”‚ â””â”€â”€ ReadModels/
â”‚ â”‚ â”‚ â””â”€â”€ {YourEntity}ListReadModel.php
â”‚ â”‚ â””â”€â”€ Get{YourEntity}/
â”‚ â”‚ â”œâ”€â”€ Get{YourEntity}Query.php
â”‚ â”‚ â”œâ”€â”€ Get{YourEntity}Handler.php
â”‚ â”‚ â””â”€â”€ ReadModels/
â”‚ â”‚ â””â”€â”€ {YourEntity}DetailReadModel.php
â”‚ â”‚
â”‚ â”œâ”€â”€ DTOs/
â”‚ â”‚ â”œâ”€â”€ Create{YourEntity}DTO.php # spatie/laravel-data
â”‚ â”‚ â”œâ”€â”€ Update{YourEntity}DTO.php
â”‚ â”‚ â””â”€â”€ {YourEntity}FilterDTO.php # page, perPage, search, dateFrom, dateTo, sortBy, sortDir
â”‚ â”‚
â”‚ â””â”€â”€ EventListeners/
â”‚ â””â”€â”€ On{YourEntity}Created.php # React to domain events (async)
â”‚
â””â”€â”€ Infrastructure/ # ðŸ”Œ LAYER 3 â€” Framework + adapters
â”‚
â”œâ”€â”€ Http/
â”‚ â”œâ”€â”€ Controllers/
â”‚ â”‚ â”œâ”€â”€ Api/
â”‚ â”‚ â”‚ â”œâ”€â”€ {YourEntity}Controller.php # index, show, store, update, destroy
â”‚ â”‚ â”‚ â””â”€â”€ {YourEntity}ExportController.php # GET /export?format=excel|pdf
â”‚ â”‚ â””â”€â”€ Web/
â”‚ â”‚ â””â”€â”€ {YourEntity}PageController.php # Inertia responses
â”‚ â”‚
â”‚ â”œâ”€â”€ Requests/
â”‚ â”‚ â”œâ”€â”€ {YourEntity}FilterRequest.php # Validates FilterDTO fields
â”‚ â”‚ â”œâ”€â”€ Create{YourEntity}Request.php
â”‚ â”‚ â””â”€â”€ Update{YourEntity}Request.php
â”‚ â”‚
â”‚ â””â”€â”€ Resources/
â”‚ â”œâ”€â”€ {YourEntity}Resource.php
â”‚ â””â”€â”€ {YourEntity}Collection.php
â”‚
â”œâ”€â”€ WebSocket/ # Only if this module has real-time updates
â”‚ â”œâ”€â”€ Channels/
â”‚ â”‚ â””â”€â”€ {YourEntity}Channel.php
â”‚ â””â”€â”€ Events/
â”‚ â””â”€â”€ {YourEntity}UpdatedBroadcast.php
â”‚
â”œâ”€â”€ Persistence/
â”‚ â”œâ”€â”€ Eloquent/
â”‚ â”‚ â”œâ”€â”€ Models/
â”‚ â”‚ â”‚ â””â”€â”€ {YourEntity}EloquentModel.php # âš ï¸ ALWAYS add @internal docblock
â”‚ â”‚ â”‚ # SoftDeletes + timestamps
â”‚ â”‚ â”œâ”€â”€ Migrations/
â”‚ â”‚ â”‚ â””â”€â”€ 2026_xx_create*{your_entities}\_table.php
â”‚ â”‚ â”œâ”€â”€ Seeders/
â”‚ â”‚ â”‚ â””â”€â”€ {YourEntity}Seeder.php
â”‚ â”‚ â””â”€â”€ Factories/
â”‚ â”‚ â””â”€â”€ {YourEntity}Factory.php
â”‚ â”‚
â”‚ â”œâ”€â”€ Repositories/
â”‚ â”‚ â””â”€â”€ Eloquent{YourEntity}Repository.php # Implements {YourEntity}RepositoryPort
â”‚ â”‚ # Uses {YourEntity}Mapper internally
â”‚ â”‚
â”‚ â””â”€â”€ Mappers/
â”‚ â””â”€â”€ {YourEntity}Mapper.php # Eloquent â†” Domain Entity
â”‚ # ONLY class allowed to import both
â”‚
â”œâ”€â”€ Queue/
â”‚ â””â”€â”€ Jobs/
â”‚ â””â”€â”€ Export{YourEntity}QueuedJob.php # For large exports >50MB
â”‚
â””â”€â”€ Routes/
â”œâ”€â”€ api.php # GET /api/{your-module}/{your-entities}
â”‚ # POST /api/{your-module}/{your-entities}
â”‚ # GET /api/{your-module}/{your-entities}/{id}
â”‚ # PUT /api/{your-module}/{your-entities}/{id}
â”‚ # DELETE /api/{your-module}/{your-entities}/{id}
â”‚ # GET /api/{your-module}/{your-entities}/export?format=excel|pdf
â”œâ”€â”€ web.php # Inertia routes (if applicable)
â””â”€â”€ channels.php # Reverb channels (if applicable)

---

ðŸ›¡ï¸ Architecture Enforcement

â‘  @internal on ALL Eloquent Models
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Every \*EloquentModel.php must carry this docblock.
PHPStan level 8 will error if any class outside Infrastructure imports it.

    /**
     * Eloquent persistence model.
     *
     * @internal Only for use within Infrastructure\Persistence.
     *           Outside this layer, always inject the Repository Port.
     */
    final class {YourEntity}EloquentModel extends Model
    {
        // ...
    }

â‘¡ PHPStan Configuration (phpstan.neon â€” place at project root)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    includes:
        - vendor/nunomaduro/larastan/extension.neon

    parameters:
        level: 8
        paths:
            - src
            - tests

        checkInternalClassCaseSensitivity: true
        internalTag: '@internal'

        excludePaths:
            - _ide_helper.php
            - _ide_helper_models.php

        reportUnmatchedIgnoredErrors: true
        checkMissingIterableValueType: true

With this config, any Handler, Controller or Service that imports
an @internal EloquentModel directly will fail CI before merge.

â‘¢ TransactionalHandler â€” DB transaction base class
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Extend this in any Command Handler that needs atomic DB operations.

    // Shared/Application/Transactions/TransactionalHandler.php
    abstract class TransactionalHandler
    {
        public function __construct(
            private readonly DatabaseTransaction $transaction
        ) {}

        protected function runInTransaction(Closure $callback): mixed
        {
            return $this->transaction->run($callback);
        }
    }

    // Usage in a Command Handler:
    class CreateUserHandler extends TransactionalHandler
    {
        public function handle(CreateUserCommand $command): void
        {
            $this->runInTransaction(function () use ($command) {
                $user = new User(...);
                $this->userRepository->save($user);
                $this->profileRepository->save($user->profile());
            });
        }
    }

â‘£ Mapper pattern â€” the only class that touches both worlds
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    // Infrastructure/Persistence/Mappers/UserMapper.php
    final class UserMapper
    {
        public function toDomain(UserEloquentModel $model): User
        {
            return new User(
                id:     new UserId($model->id),
                email:  new UserEmail($model->email),
                status: UserStatus::from($model->status),
            );
        }

        public function toEloquent(User $user): UserEloquentModel
        {
            $model = UserEloquentModel::findOrNew($user->id()->value());
            $model->email  = $user->email()->value();
            $model->status = $user->status()->value;
            return $model;
        }
    }

    // Repository uses Mapper â€” never imports Domain Entity directly in queries
    final class EloquentUserRepository implements UserRepositoryPort
    {
        public function __construct(private readonly UserMapper $mapper) {}

        public function findById(UserId $id): ?User
        {
            $model = UserEloquentModel::find($id->value());
            return $model ? $this->mapper->toDomain($model) : null;
        }

        public function save(User $user): void
        {
            $this->mapper->toEloquent($user)->save();
        }
    }

â‘¤ CQRS without Bus â€” call handlers directly
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
No CommandBus overhead. Inject the handler directly in the controller.

    // Infrastructure/Http/Controllers/Api/AdminUserController.php
    final class AdminUserController extends Controller
    {
        public function __construct(
            private readonly CreateUserHandler    $createUser,
            private readonly ListUsersHandler     $listUsers,
            private readonly SuspendUserHandler   $suspendUser,
        ) {}

        public function store(CreateUserRequest $request): JsonResponse
        {
            $this->createUser->handle(
                new CreateUserCommand(
                    name:  $request->validated('name'),
                    email: $request->validated('email'),
                    role:  $request->validated('role'),
                )
            );
            return response()->json(['message' => 'User created'], 201);
        }

        public function index(UserFilterRequest $request): JsonResponse
        {
            $result = $this->listUsers->handle(
                new ListUsersQuery(FilterDTO::from($request->validated()))
            );
            return UserCollection::make($result)->response();
        }
    }

â‘¥ Query side â€” Eloquent used directly (no Mapper needed)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Read operations do not need domain invariants â€” Eloquent is fine here.

    // Application/Queries/ListUsers/ListUsersHandler.php
    final class ListUsersHandler
    {
        public function handle(ListUsersQuery $query): LengthAwarePaginator
        {
            return UserEloquentModel::query()
                ->when($query->filter->search, fn($q) =>
                    $q->where('name', 'like', "%{$query->filter->search}%")
                      ->orWhere('email', 'like', "%{$query->filter->search}%")
                )
                ->when($query->filter->status, fn($q) =>
                    $q->where('status', $query->filter->status)
                )
                ->select(['id', 'name', 'email', 'status', 'created_at'])
                ->paginate($query->filter->perPage)
                ->through(fn($m) => UserListReadModel::fromEloquent($m));
        }
    }

â‘¦ Circuit Breaker â€” wrap external service calls
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Use on FastAPI, payment gateways, or any unreliable external HTTP call.

    // Infrastructure/ExternalServices/FastAPI/FastAPIAdapter.php
    final class FastAPIAdapter implements FastAPIClientInterface
    {
        public function __construct(
            private readonly CircuitBreaker $circuitBreaker,
            private readonly RetryPolicy    $retryPolicy,
            private readonly Http           $http,
        ) {}

        public function predict(PredictionRequestDTO $dto): PredictionResponseDTO
        {
            return $this->circuitBreaker->call(
                fn() => $this->retryPolicy->execute(
                    fn() => $this->http->post('/predict', $dto->toArray())
                )
            );
        }
    }

---

ðŸ“¦ Composer Packages â†’ Architecture Mapping

# Core framework

laravel/framework â†’ All modules
laravel/sanctum â†’ Auth/Infrastructure (HasApiTokens)
laravel/fortify â†’ Auth/Application/Services/AuthenticationService.php
laravel/reverb â†’ Shared/Infrastructure/Broadcasting/ReverbAdapter.php
laravel/horizon â†’ Shared/Infrastructure/Queue/ (dashboard + worker management)

# Queue / messaging

vladimir-yuldashev/laravel-queue-rabbitmq â†’ Shared/Infrastructure/Queue/RabbitMQAdapter.php

# Auth / permissions

spatie/laravel-permission â†’ Auth/Application/Permissions/ + UserEloquentModel HasRoles
spatie/laravel-one-time-passwords â†’ Auth/Domain/Services/OtpGenerator.php
laravel/socialite â†’ Auth/Infrastructure/ExternalServices/OAuth/

# Domain / application

spatie/laravel-data â†’ Shared/Application/DTOs/BaseDTO.php + all DTOs
ramsey/uuid â†’ Shared/Domain/ValueObjects/Uuid.php

# Storage

league/flysystem-aws-s3-v3 â†’ Shared/Infrastructure/Storage/S3StorageAdapter.php
spatie/laravel-medialibrary â†’ Shared/Infrastructure/Storage/SpatieMediaLibraryAdapter.php
intervention/image â†’ Users/Infrastructure/Queue/Jobs/ProcessAvatarJob.php

# Mail

resend/resend-laravel â†’ Shared/Infrastructure/Mail/ResendAdapter.php

# Exports

maatwebsite/excel â†’ Shared/Infrastructure/Export/ExcelAdapter.php
barryvdh/laravel-dompdf â†’ Shared/Infrastructure/Export/PdfAdapter.php

# Observability

open-telemetry/opentelemetry-php â†’ Shared/Infrastructure/Observability/Tracing/
open-telemetry/exporter-otlp â†’ Shared/Infrastructure/Observability/Tracing/OpenTelemetryAdapter.php
monolog/monolog â†’ Shared/Infrastructure/Logging/ (central bus + Processors)

# Audit

spatie/laravel-activitylog â†’ Shared/Infrastructure/Audit/SpatieActivityLogAdapter.php

# AI

prism-php/prism â†’ AI/Infrastructure/ExternalServices/Prism/

# Static analysis

nunomaduro/larastan â†’ phpstan.neon (Laravel-aware rules)
phpstan/phpstan-strict-rules â†’ phpstan.neon (strict mode)

# Testing

pestphp/pest â†’ All modules Tests/
pestphp/pest-plugin-laravel â†’ Feature tests
spatie/laravel-backup â†’ Shared/Infrastructure/ (scheduled backups)

# Dev only

barryvdh/laravel-debugbar â†’ Dev only (APP_DEBUG=true)
barryvdh/laravel-ide-helper â†’ Dev only (\_ide_helper.php)

---

ðŸ“ Layer Rules â€” what each layer can and cannot import

    Layer           â”‚ Can import                                    â”‚ Cannot import
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    Domain          â”‚ Shared/Domain, own VOs, own Enums             â”‚ Eloquent, Laravel, HTTP, Queues
    Application     â”‚ Domain, Shared/Application, DTOs              â”‚ Eloquent (@internal enforced)
    Infrastructure  â”‚ Domain (Ports), Application, Eloquent         â”‚ No restrictions â€” it's the adapter
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    The Mapper is the ONLY class in the codebase allowed to import
    both the Domain Entity AND the EloquentModel simultaneously.
    No Controller, Handler, or Service should ever do this.

---

ðŸ”¥ Key Differences vs Full Enterprise Architecture

    Feature                      â”‚ This (Intermediate)        â”‚ Full Enterprise
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    CommandBus / QueryBus        â”‚ âŒ Direct handler calls     â”‚ âœ… Formal Bus with middleware
    IntegrationEvents            â”‚ âŒ Laravel Events           â”‚ âœ… Dedicated IntegrationEvent layer
    Anti-Corruption Layer (ACL)  â”‚ âŒ Not needed for 2 devs   â”‚ âœ… Between every context
    Contracts / Published Lang.  â”‚ âŒ Not needed for 2 devs   â”‚ âœ… Per context
    PHPArkitect tests            â”‚ âŒ PHPStan is enough        â”‚ âœ… CI layer boundary tests
    Domain Subscribers           â”‚ âŒ Laravel Event Listeners  â”‚ âœ… Synchronous domain subscribers
    Bounded Contexts             â”‚ Modules (lighter)           â”‚ Full DDD Bounded Contexts
    Team size                    â”‚ 2 senior devs               â”‚ 6-10+ devs
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    When to upgrade to the full architecture:
    â†’ Team grows to 4+ developers
    â†’ Two devs need to work on the same module without conflicts
    â†’ Modules have business rules that genuinely conflict
    â†’ Parts of the system need to scale independently

â”€â”€ CRUD Route Pattern â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    Every CRUD module MUST register both Inertia page routes and API routes.
    All module routes live inside the authenticated middleware group in routes/web.php.
    Routes MUST use {uuid} (not {id}) to prevent enumeration attacks.

    Web (Inertia pages) â€” prefix: /{module}

        GET    /{module}                  â†’ PageController@index    â†’ {module}.index
        GET    /{module}/create           â†’ PageController@create   â†’ {module}.create
        GET    /{module}/{uuid}           â†’ PageController@show     â†’ {module}.show
        GET    /{module}/{uuid}/edit      â†’ PageController@edit     â†’ {module}.edit
        DELETE /{module}/{uuid}           â†’ PageController@destroy  â†’ {module}.destroy
        PATCH  /{module}/{uuid}/restore   â†’ PageController@restore  â†’ {module}.restore

    API â€” prefix: /api/{module}

        GET    /api/{module}              â†’ Controller@index    â†’ api.{module}.index
        GET    /api/{module}/{uuid}       â†’ Controller@show     â†’ api.{module}.show
        POST   /api/{module}              â†’ Controller@store    â†’ api.{module}.store
        PUT    /api/{module}/{uuid}       â†’ Controller@update   â†’ api.{module}.update
        DELETE /api/{module}/{uuid}       â†’ Controller@destroy  â†’ api.{module}.destroy
        PATCH  /api/{module}/{uuid}/restore â†’ Controller@restore â†’ api.{module}.restore

    All uuid parameters must use ->whereUuid('uuid').

â”€â”€ Permissions & Roles Convention â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    For every CRUD module, generate 4 permissions + 1 role:

    Permissions:  VIEW_{MODULE}, CREATE_{MODULE}, UPDATE_{MODULE}, DELETE_{MODULE}
    Role:         {ModuleName} (PascalCase)
    Super Admin:  Always receives all module permissions.

    The permissions seeder MUST call:
        app()[\Spatie\Permission\PermissionRegistrar::class]->forgetCachedPermissions();
    BEFORE creating any permissions.

â”€â”€ SoftDeletes Convention â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    Every CRUD module MUST include:
    1. SoftDeletes trait on EloquentModel (adds deleted_at column).
    2. softDeletes() in the migration.
    3. softDelete(string $uuid) + restore(string $uuid) on the Repository Port.
    4. DELETE + PATCH/restore routes in both web and API route groups.
    5. The delete handler performs soft-delete (->delete()), not hard-delete.

â”€â”€ Controller Convention â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    Controllers are orchestrators ONLY â€” they contain NO business logic.
    Pattern: inject CQRS handlers directly (no Bus in intermediate arch).

    Web Controllers (Inertia):  return Inertia::render('module/PageName', [...])
    API Controllers:            return response()->json([...])

    Every CRUD API Controller must have: index, show, store, update, destroy, restore
    Every CRUD Web Controller must have: index, create, show, edit, destroy, restore

â”€â”€ Eloquent Query Conventions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    1. Always use select() â€” never SELECT *.
    2. Always use paginate() â€” never unbounded get() on listing queries.
    3. Use when() for conditional filters.
    4. Use scopeInDateRange() for date filtering.
    5. Query by uuid column, never by id, in all public-facing operations.

â”€â”€ Export Conventions (Excel & PDF) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    Every CRUD module MUST expose endpoints for Excel and PDF reporting.
    1. Excel: Uses maatwebsite/excel (implement FromQuery, WithHeadings, WithMapping, ShouldAutoSize).
    2. PDF: Uses barryvdh/laravel-dompdf (stylized template with Logo PNG.png).
    3. Both exports MUST reuse the same FilterDTO used for listing.
    4. Both exports MUST respect the current active filters (search, date range, etc.).
    5. Route pattern: GET /api/{module}/export?format=excel|pdf
    6. UI Requirement: Add ExportButton component to every index page.
